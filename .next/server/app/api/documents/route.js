"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/documents/route";
exports.ids = ["app/api/documents/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdocuments%2Froute&page=%2Fapi%2Fdocuments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdocuments%2Froute.ts&appDir=C%3A%5CUsers%5Caksha%5CDocuments%5CGitHub%5Csalak%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Caksha%5CDocuments%5CGitHub%5Csalak&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdocuments%2Froute&page=%2Fapi%2Fdocuments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdocuments%2Froute.ts&appDir=C%3A%5CUsers%5Caksha%5CDocuments%5CGitHub%5Csalak%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Caksha%5CDocuments%5CGitHub%5Csalak&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_aksha_Documents_GitHub_salak_app_api_documents_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/documents/route.ts */ \"(rsc)/./app/api/documents/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/documents/route\",\n        pathname: \"/api/documents\",\n        filename: \"route\",\n        bundlePath: \"app/api/documents/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\aksha\\\\Documents\\\\GitHub\\\\salak\\\\app\\\\api\\\\documents\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_aksha_Documents_GitHub_salak_app_api_documents_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/documents/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZkb2N1bWVudHMlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmRvY3VtZW50cyUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmRvY3VtZW50cyUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNha3NoYSU1Q0RvY3VtZW50cyU1Q0dpdEh1YiU1Q3NhbGFrJTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1DJTNBJTVDVXNlcnMlNUNha3NoYSU1Q0RvY3VtZW50cyU1Q0dpdEh1YiU1Q3NhbGFrJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUN5QjtBQUN0RztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovLy8/YmE2NSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxVc2Vyc1xcXFxha3NoYVxcXFxEb2N1bWVudHNcXFxcR2l0SHViXFxcXHNhbGFrXFxcXGFwcFxcXFxhcGlcXFxcZG9jdW1lbnRzXFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9kb2N1bWVudHMvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9kb2N1bWVudHNcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2RvY3VtZW50cy9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXFVzZXJzXFxcXGFrc2hhXFxcXERvY3VtZW50c1xcXFxHaXRIdWJcXFxcc2FsYWtcXFxcYXBwXFxcXGFwaVxcXFxkb2N1bWVudHNcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2RvY3VtZW50cy9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdocuments%2Froute&page=%2Fapi%2Fdocuments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdocuments%2Froute.ts&appDir=C%3A%5CUsers%5Caksha%5CDocuments%5CGitHub%5Csalak%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Caksha%5CDocuments%5CGitHub%5Csalak&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/documents/route.ts":
/*!************************************!*\
  !*** ./app/api/documents/route.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_supabase__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/supabase */ \"(rsc)/./lib/supabase.ts\");\n/* harmony import */ var _lib_auth_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/auth-helpers */ \"(rsc)/./lib/auth-helpers.ts\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_3__);\n\n\n\n\n// POST /documents - Create a new document with file upload\nasync function POST(request) {\n    try {\n        console.log(\"[Upload API] Headers:\", Object.fromEntries(request.headers.entries()));\n        console.log(\"[Upload API] Auth header:\", request.headers.get(\"authorization\"));\n        const user = await (0,_lib_auth_helpers__WEBPACK_IMPORTED_MODULE_2__.getAuthenticatedUser)(request);\n        if (!user) {\n            console.log(\"[Upload API] Authentication failed - no user found\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        console.log(\"[Upload API] User authenticated:\", user.email);\n        const supabase = (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.createServerClient)();\n        // Handle multipart form data for file upload\n        console.log(\"[Upload] Processing file upload request\");\n        console.log(\"[Upload] Content-Type:\", request.headers.get(\"content-type\"));\n        let formData;\n        try {\n            formData = await request.formData();\n            console.log(\"[Upload] FormData parsed successfully\");\n            console.log(\"[Upload] FormData keys:\", Array.from(formData.keys()));\n        } catch (formDataError) {\n            console.error(\"[Upload] Error parsing FormData:\", formDataError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to parse form data. Please ensure the request is sent as multipart/form-data.\"\n            }, {\n                status: 400\n            });\n        }\n        const file = formData.get(\"file\");\n        let name = formData.get(\"name\");\n        const description = formData.get(\"description\");\n        const category_id = formData.get(\"category_id\");\n        const tagsString = formData.get(\"tags\");\n        console.log(\"[Upload] File received:\", {\n            name,\n            type: file?.type,\n            size: file?.size\n        });\n        // Validation\n        if (!file) {\n            console.error(\"[Upload] No file provided\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"No file provided\"\n            }, {\n                status: 400\n            });\n        }\n        if (!name) {\n            name = file.name;\n        }\n        // Parse tags\n        const tags = tagsString ? tagsString.split(\",\").map((t)=>t.trim()).filter((t)=>t) : [];\n        // Generate unique filename to avoid conflicts\n        const fileExtension = file.name.split(\".\").pop();\n        const uniqueFilename = `${(0,crypto__WEBPACK_IMPORTED_MODULE_3__.randomUUID)()}.${fileExtension}`;\n        // Upload file to Supabase Storage bucket \"Files\"\n        const bucketName = \"Files\";\n        console.log(\"[Upload] Attempting to upload to bucket:\", bucketName, \"filename:\", uniqueFilename);\n        console.log(\"[Upload] File type:\", file.type, \"File size:\", file.size);\n        // Convert File to ArrayBuffer for Supabase Storage\n        let fileBuffer;\n        try {\n            if (file instanceof File) {\n                fileBuffer = await file.arrayBuffer();\n            } else {\n                // If it's already a buffer or Blob\n                fileBuffer = file;\n            }\n            console.log(\"[Upload] File converted to buffer, size:\", fileBuffer.byteLength);\n        } catch (bufferError) {\n            console.error(\"[Upload] Error converting file to buffer:\", bufferError);\n            await (0,_lib_auth_helpers__WEBPACK_IMPORTED_MODULE_2__.logAction)(user.id, \"Document Upload\", name, \"failed\", (0,_lib_auth_helpers__WEBPACK_IMPORTED_MODULE_2__.getClientIp)(request));\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to process file for upload\"\n            }, {\n                status: 500\n            });\n        }\n        const { data: uploadData, error: uploadError } = await supabase.storage.from(bucketName).upload(uniqueFilename, fileBuffer, {\n            cacheControl: \"3600\",\n            upsert: false,\n            contentType: file.type || \"application/octet-stream\"\n        });\n        if (uploadError) {\n            console.error(\"[Upload] File upload error:\", uploadError);\n            console.error(\"[Upload] Error details:\", JSON.stringify(uploadError, null, 2));\n            await (0,_lib_auth_helpers__WEBPACK_IMPORTED_MODULE_2__.logAction)(user.id, \"Document Upload\", name, \"failed\", (0,_lib_auth_helpers__WEBPACK_IMPORTED_MODULE_2__.getClientIp)(request));\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: `Failed to upload file to storage: ${uploadError.message}`\n            }, {\n                status: 500\n            });\n        }\n        console.log(\"[Upload] File uploaded successfully:\", uploadData);\n        // Create document record with the storage path\n        // Set both user_id and uploaded_by to ensure proper user isolation\n        const { data: document, error: docError } = await supabase.from(\"documents\").insert({\n            name,\n            description: description || null,\n            file_path: uniqueFilename,\n            file_size: file.size,\n            file_type: file.type,\n            category_id: category_id || null,\n            user_id: user.id,\n            uploaded_by: user.id,\n            status: \"active\",\n            tags: tags,\n            version: 1\n        }).select().single();\n        if (docError || !document) {\n            console.error(\"Document creation error:\", docError);\n            // Try to clean up uploaded file if document creation failed\n            try {\n                await supabase.storage.from(bucketName).remove([\n                    uniqueFilename\n                ]);\n            } catch (cleanupError) {\n                console.error(\"Failed to cleanup uploaded file:\", cleanupError);\n            }\n            await (0,_lib_auth_helpers__WEBPACK_IMPORTED_MODULE_2__.logAction)(user.id, \"Document Upload\", name, \"failed\", (0,_lib_auth_helpers__WEBPACK_IMPORTED_MODULE_2__.getClientIp)(request));\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to create document record\"\n            }, {\n                status: 500\n            });\n        }\n        await (0,_lib_auth_helpers__WEBPACK_IMPORTED_MODULE_2__.logAction)(user.id, \"Document Upload\", `${name} (${document.id})`, \"success\", (0,_lib_auth_helpers__WEBPACK_IMPORTED_MODULE_2__.getClientIp)(request));\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            document\n        }, {\n            status: 201\n        });\n    } catch (error) {\n        console.error(\"[Upload] Create document error:\", error);\n        console.error(\"[Upload] Error stack:\", error instanceof Error ? error.stack : \"No stack trace\");\n        console.error(\"[Upload] Error message:\", error instanceof Error ? error.message : String(error));\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\",\n            details:  true ? error instanceof Error ? error.message : String(error) : 0\n        }, {\n            status: 500\n        });\n    }\n}\n// GET /documents - Get all documents with filtering\nasync function GET(request) {\n    try {\n        console.log(\"[Documents GET] Headers:\", Object.fromEntries(request.headers.entries()));\n        console.log(\"[Documents GET] Auth header:\", request.headers.get(\"authorization\"));\n        const user = await (0,_lib_auth_helpers__WEBPACK_IMPORTED_MODULE_2__.getAuthenticatedUser)(request);\n        if (!user) {\n            console.log(\"[Documents GET] Authentication failed\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        console.log(\"[Documents GET] User authenticated:\", user.email);\n        const { searchParams } = new URL(request.url);\n        const categoryId = searchParams.get(\"category_id\");\n        const status = searchParams.get(\"status\") || \"active\";\n        const search = searchParams.get(\"search\");\n        const page = parseInt(searchParams.get(\"page\") || \"1\");\n        const limit = parseInt(searchParams.get(\"limit\") || \"50\");\n        const offset = (page - 1) * limit;\n        const supabase = (0,_lib_supabase__WEBPACK_IMPORTED_MODULE_1__.createServerClient)();\n        // Build query - filter by user_id or uploaded_by to ensure users only see their own documents\n        let query = supabase.from(\"documents\").select(`\n        *,\n        categories:category_id (\n          id,\n          name,\n          description\n        ),\n        uploader:uploaded_by (\n          id,\n          name,\n          email\n        )\n      `, {\n            count: \"exact\"\n        }).order(\"created_at\", {\n            ascending: false\n        }).range(offset, offset + limit - 1);\n        // CRITICAL: Filter by user to ensure users only see their own documents\n        // Check both user_id and uploaded_by for backward compatibility\n        // Use .or() with proper format\n        query = query.or(`user_id.eq.${user.id},uploaded_by.eq.${user.id}`);\n        // Apply filters\n        if (status) {\n            query = query.eq(\"status\", status);\n        }\n        if (categoryId) {\n            query = query.eq(\"category_id\", categoryId);\n        }\n        if (search) {\n            query = query.or(`name.ilike.%${search}%,description.ilike.%${search}%`);\n        }\n        // Non-admins can only see active documents\n        if (user.role !== \"admin\") {\n            query = query.eq(\"status\", \"active\");\n        }\n        const { data: documents, error, count } = await query;\n        if (error) {\n            console.error(\"Get documents error:\", error);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to fetch documents\"\n            }, {\n                status: 500\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            documents: documents || [],\n            pagination: {\n                page,\n                limit,\n                total: count || 0,\n                totalPages: Math.ceil((count || 0) / limit)\n            }\n        });\n    } catch (error) {\n        console.error(\"Get documents error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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WUFDdEMsT0FBT2pCLHFEQUFZQSxDQUFDZ0IsSUFBSSxDQUN0QjtnQkFBRUMsT0FBTztZQUE0QixHQUNyQztnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsT0FBT2xCLHFEQUFZQSxDQUFDZ0IsSUFBSSxDQUFDO1lBQ3ZCeUQsU0FBUztZQUNUeUIsV0FBV0EsYUFBYSxFQUFFO1lBQzFCQyxZQUFZO2dCQUNWYjtnQkFDQUU7Z0JBQ0FZLE9BQU9ULFNBQVM7Z0JBQ2hCVSxZQUFZQyxLQUFLQyxJQUFJLENBQUMsQ0FBQ1osU0FBUyxLQUFLSDtZQUN2QztRQUNGO0lBQ0YsRUFBRSxPQUFPdkUsT0FBTztRQUNkVCxRQUFRUyxLQUFLLENBQUMsd0JBQXdCQTtRQUN0QyxPQUFPakIscURBQVlBLENBQUNnQixJQUFJLENBQ3RCO1lBQUVDLE9BQU87UUFBd0IsR0FDakM7WUFBRUMsUUFBUTtRQUFJO0lBRWxCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9hcHAvYXBpL2RvY3VtZW50cy9yb3V0ZS50cz83MTdlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcidcbmltcG9ydCB7IGNyZWF0ZVNlcnZlckNsaWVudCB9IGZyb20gJ0AvbGliL3N1cGFiYXNlJ1xuaW1wb3J0IHsgZ2V0QXV0aGVudGljYXRlZFVzZXIsIGxvZ0FjdGlvbiwgZ2V0Q2xpZW50SXAgfSBmcm9tICdAL2xpYi9hdXRoLWhlbHBlcnMnXG5pbXBvcnQgeyByYW5kb21VVUlEIH0gZnJvbSAnY3J5cHRvJ1xuXG4vLyBQT1NUIC9kb2N1bWVudHMgLSBDcmVhdGUgYSBuZXcgZG9jdW1lbnQgd2l0aCBmaWxlIHVwbG9hZFxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZygnW1VwbG9hZCBBUEldIEhlYWRlcnM6JywgT2JqZWN0LmZyb21FbnRyaWVzKHJlcXVlc3QuaGVhZGVycy5lbnRyaWVzKCkpKVxuICAgIGNvbnNvbGUubG9nKCdbVXBsb2FkIEFQSV0gQXV0aCBoZWFkZXI6JywgcmVxdWVzdC5oZWFkZXJzLmdldCgnYXV0aG9yaXphdGlvbicpKVxuXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IGdldEF1dGhlbnRpY2F0ZWRVc2VyKHJlcXVlc3QpXG5cbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdbVXBsb2FkIEFQSV0gQXV0aGVudGljYXRpb24gZmFpbGVkIC0gbm8gdXNlciBmb3VuZCcpXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCdbVXBsb2FkIEFQSV0gVXNlciBhdXRoZW50aWNhdGVkOicsIHVzZXIuZW1haWwpXG5cbiAgICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZVNlcnZlckNsaWVudCgpXG5cbiAgICAvLyBIYW5kbGUgbXVsdGlwYXJ0IGZvcm0gZGF0YSBmb3IgZmlsZSB1cGxvYWRcbiAgICBjb25zb2xlLmxvZygnW1VwbG9hZF0gUHJvY2Vzc2luZyBmaWxlIHVwbG9hZCByZXF1ZXN0JylcbiAgICBjb25zb2xlLmxvZygnW1VwbG9hZF0gQ29udGVudC1UeXBlOicsIHJlcXVlc3QuaGVhZGVycy5nZXQoJ2NvbnRlbnQtdHlwZScpKVxuICAgIFxuICAgIGxldCBmb3JtRGF0YTogRm9ybURhdGFcbiAgICB0cnkge1xuICAgICAgZm9ybURhdGEgPSBhd2FpdCByZXF1ZXN0LmZvcm1EYXRhKClcbiAgICAgIGNvbnNvbGUubG9nKCdbVXBsb2FkXSBGb3JtRGF0YSBwYXJzZWQgc3VjY2Vzc2Z1bGx5JylcbiAgICAgIGNvbnNvbGUubG9nKCdbVXBsb2FkXSBGb3JtRGF0YSBrZXlzOicsIEFycmF5LmZyb20oZm9ybURhdGEua2V5cygpKSlcbiAgICB9IGNhdGNoIChmb3JtRGF0YUVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbVXBsb2FkXSBFcnJvciBwYXJzaW5nIEZvcm1EYXRhOicsIGZvcm1EYXRhRXJyb3IpXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gcGFyc2UgZm9ybSBkYXRhLiBQbGVhc2UgZW5zdXJlIHRoZSByZXF1ZXN0IGlzIHNlbnQgYXMgbXVsdGlwYXJ0L2Zvcm0tZGF0YS4nIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGZpbGUgPSBmb3JtRGF0YS5nZXQoJ2ZpbGUnKSBhcyBGaWxlXG4gICAgbGV0IG5hbWUgPSBmb3JtRGF0YS5nZXQoJ25hbWUnKSBhcyBzdHJpbmdcbiAgICBjb25zdCBkZXNjcmlwdGlvbiA9IGZvcm1EYXRhLmdldCgnZGVzY3JpcHRpb24nKSBhcyBzdHJpbmdcbiAgICBjb25zdCBjYXRlZ29yeV9pZCA9IGZvcm1EYXRhLmdldCgnY2F0ZWdvcnlfaWQnKSBhcyBzdHJpbmdcbiAgICBjb25zdCB0YWdzU3RyaW5nID0gZm9ybURhdGEuZ2V0KCd0YWdzJykgYXMgc3RyaW5nXG5cbiAgICBjb25zb2xlLmxvZygnW1VwbG9hZF0gRmlsZSByZWNlaXZlZDonLCB7IG5hbWUsIHR5cGU6IGZpbGU/LnR5cGUsIHNpemU6IGZpbGU/LnNpemUgfSlcblxuICAgIC8vIFZhbGlkYXRpb25cbiAgICBpZiAoIWZpbGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tVcGxvYWRdIE5vIGZpbGUgcHJvdmlkZWQnKVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnTm8gZmlsZSBwcm92aWRlZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgaWYgKCFuYW1lKSB7XG4gICAgICBuYW1lID0gZmlsZS5uYW1lXG4gICAgfVxuXG4gICAgLy8gUGFyc2UgdGFnc1xuICAgIGNvbnN0IHRhZ3MgPSB0YWdzU3RyaW5nXG4gICAgICA/IHRhZ3NTdHJpbmcuc3BsaXQoJywnKS5tYXAodCA9PiB0LnRyaW0oKSkuZmlsdGVyKHQgPT4gdClcbiAgICAgIDogW11cblxuICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBmaWxlbmFtZSB0byBhdm9pZCBjb25mbGljdHNcbiAgICBjb25zdCBmaWxlRXh0ZW5zaW9uID0gZmlsZS5uYW1lLnNwbGl0KCcuJykucG9wKClcbiAgICBjb25zdCB1bmlxdWVGaWxlbmFtZSA9IGAke3JhbmRvbVVVSUQoKX0uJHtmaWxlRXh0ZW5zaW9ufWBcblxuICAgIC8vIFVwbG9hZCBmaWxlIHRvIFN1cGFiYXNlIFN0b3JhZ2UgYnVja2V0IFwiRmlsZXNcIlxuICAgIGNvbnN0IGJ1Y2tldE5hbWUgPSAnRmlsZXMnXG4gICAgY29uc29sZS5sb2coJ1tVcGxvYWRdIEF0dGVtcHRpbmcgdG8gdXBsb2FkIHRvIGJ1Y2tldDonLCBidWNrZXROYW1lLCAnZmlsZW5hbWU6JywgdW5pcXVlRmlsZW5hbWUpXG4gICAgY29uc29sZS5sb2coJ1tVcGxvYWRdIEZpbGUgdHlwZTonLCBmaWxlLnR5cGUsICdGaWxlIHNpemU6JywgZmlsZS5zaXplKVxuXG4gICAgLy8gQ29udmVydCBGaWxlIHRvIEFycmF5QnVmZmVyIGZvciBTdXBhYmFzZSBTdG9yYWdlXG4gICAgbGV0IGZpbGVCdWZmZXI6IEFycmF5QnVmZmVyXG4gICAgdHJ5IHtcbiAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgRmlsZSkge1xuICAgICAgICBmaWxlQnVmZmVyID0gYXdhaXQgZmlsZS5hcnJheUJ1ZmZlcigpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBJZiBpdCdzIGFscmVhZHkgYSBidWZmZXIgb3IgQmxvYlxuICAgICAgICBmaWxlQnVmZmVyID0gZmlsZSBhcyBBcnJheUJ1ZmZlclxuICAgICAgfVxuICAgICAgY29uc29sZS5sb2coJ1tVcGxvYWRdIEZpbGUgY29udmVydGVkIHRvIGJ1ZmZlciwgc2l6ZTonLCBmaWxlQnVmZmVyLmJ5dGVMZW5ndGgpXG4gICAgfSBjYXRjaCAoYnVmZmVyRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tVcGxvYWRdIEVycm9yIGNvbnZlcnRpbmcgZmlsZSB0byBidWZmZXI6JywgYnVmZmVyRXJyb3IpXG4gICAgICBhd2FpdCBsb2dBY3Rpb24odXNlci5pZCwgJ0RvY3VtZW50IFVwbG9hZCcsIG5hbWUsICdmYWlsZWQnLCBnZXRDbGllbnRJcChyZXF1ZXN0KSlcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0ZhaWxlZCB0byBwcm9jZXNzIGZpbGUgZm9yIHVwbG9hZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgeyBkYXRhOiB1cGxvYWREYXRhLCBlcnJvcjogdXBsb2FkRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLnN0b3JhZ2VcbiAgICAgIC5mcm9tKGJ1Y2tldE5hbWUpXG4gICAgICAudXBsb2FkKHVuaXF1ZUZpbGVuYW1lLCBmaWxlQnVmZmVyLCB7XG4gICAgICAgIGNhY2hlQ29udHJvbDogJzM2MDAnLFxuICAgICAgICB1cHNlcnQ6IGZhbHNlLFxuICAgICAgICBjb250ZW50VHlwZTogZmlsZS50eXBlIHx8ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nXG4gICAgICB9KVxuXG4gICAgaWYgKHVwbG9hZEVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbVXBsb2FkXSBGaWxlIHVwbG9hZCBlcnJvcjonLCB1cGxvYWRFcnJvcilcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tVcGxvYWRdIEVycm9yIGRldGFpbHM6JywgSlNPTi5zdHJpbmdpZnkodXBsb2FkRXJyb3IsIG51bGwsIDIpKVxuICAgICAgYXdhaXQgbG9nQWN0aW9uKHVzZXIuaWQsICdEb2N1bWVudCBVcGxvYWQnLCBuYW1lLCAnZmFpbGVkJywgZ2V0Q2xpZW50SXAocmVxdWVzdCkpXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6IGBGYWlsZWQgdG8gdXBsb2FkIGZpbGUgdG8gc3RvcmFnZTogJHt1cGxvYWRFcnJvci5tZXNzYWdlfWAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coJ1tVcGxvYWRdIEZpbGUgdXBsb2FkZWQgc3VjY2Vzc2Z1bGx5OicsIHVwbG9hZERhdGEpXG5cbiAgICAvLyBDcmVhdGUgZG9jdW1lbnQgcmVjb3JkIHdpdGggdGhlIHN0b3JhZ2UgcGF0aFxuICAgIC8vIFNldCBib3RoIHVzZXJfaWQgYW5kIHVwbG9hZGVkX2J5IHRvIGVuc3VyZSBwcm9wZXIgdXNlciBpc29sYXRpb25cbiAgICBjb25zdCB7IGRhdGE6IGRvY3VtZW50LCBlcnJvcjogZG9jRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnZG9jdW1lbnRzJylcbiAgICAgIC5pbnNlcnQoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gfHwgbnVsbCxcbiAgICAgICAgZmlsZV9wYXRoOiB1bmlxdWVGaWxlbmFtZSwgLy8gU3RvcmUganVzdCB0aGUgZmlsZW5hbWUsIGJ1Y2tldCBpcyBmaXhlZFxuICAgICAgICBmaWxlX3NpemU6IGZpbGUuc2l6ZSxcbiAgICAgICAgZmlsZV90eXBlOiBmaWxlLnR5cGUsXG4gICAgICAgIGNhdGVnb3J5X2lkOiBjYXRlZ29yeV9pZCB8fCBudWxsLFxuICAgICAgICB1c2VyX2lkOiB1c2VyLmlkLCAvLyBTZXQgdXNlcl9pZCBmb3IgdXNlciBpc29sYXRpb25cbiAgICAgICAgdXBsb2FkZWRfYnk6IHVzZXIuaWQsIC8vIEtlZXAgdXBsb2FkZWRfYnkgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHlcbiAgICAgICAgc3RhdHVzOiAnYWN0aXZlJyxcbiAgICAgICAgdGFnczogdGFncyxcbiAgICAgICAgdmVyc2lvbjogMSxcbiAgICAgIH0pXG4gICAgICAuc2VsZWN0KClcbiAgICAgIC5zaW5nbGUoKVxuXG4gICAgaWYgKGRvY0Vycm9yIHx8ICFkb2N1bWVudCkge1xuICAgICAgY29uc29sZS5lcnJvcignRG9jdW1lbnQgY3JlYXRpb24gZXJyb3I6JywgZG9jRXJyb3IpXG4gICAgICAvLyBUcnkgdG8gY2xlYW4gdXAgdXBsb2FkZWQgZmlsZSBpZiBkb2N1bWVudCBjcmVhdGlvbiBmYWlsZWRcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHN1cGFiYXNlLnN0b3JhZ2UuZnJvbShidWNrZXROYW1lKS5yZW1vdmUoW3VuaXF1ZUZpbGVuYW1lXSlcbiAgICAgIH0gY2F0Y2ggKGNsZWFudXBFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY2xlYW51cCB1cGxvYWRlZCBmaWxlOicsIGNsZWFudXBFcnJvcilcbiAgICAgIH1cblxuICAgICAgYXdhaXQgbG9nQWN0aW9uKHVzZXIuaWQsICdEb2N1bWVudCBVcGxvYWQnLCBuYW1lLCAnZmFpbGVkJywgZ2V0Q2xpZW50SXAocmVxdWVzdCkpXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIGRvY3VtZW50IHJlY29yZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgYXdhaXQgbG9nQWN0aW9uKHVzZXIuaWQsICdEb2N1bWVudCBVcGxvYWQnLCBgJHtuYW1lfSAoJHtkb2N1bWVudC5pZH0pYCwgJ3N1Y2Nlc3MnLCBnZXRDbGllbnRJcChyZXF1ZXN0KSlcblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZG9jdW1lbnQsXG4gICAgfSwgeyBzdGF0dXM6IDIwMSB9KVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tVcGxvYWRdIENyZWF0ZSBkb2N1bWVudCBlcnJvcjonLCBlcnJvcilcbiAgICBjb25zb2xlLmVycm9yKCdbVXBsb2FkXSBFcnJvciBzdGFjazonLCBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3Iuc3RhY2sgOiAnTm8gc3RhY2sgdHJhY2UnKVxuICAgIGNvbnNvbGUuZXJyb3IoJ1tVcGxvYWRdIEVycm9yIG1lc3NhZ2U6JywgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpKVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgXG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgZGV0YWlsczogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpKSA6IHVuZGVmaW5lZFxuICAgICAgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgIClcbiAgfVxufVxuXG4vLyBHRVQgL2RvY3VtZW50cyAtIEdldCBhbGwgZG9jdW1lbnRzIHdpdGggZmlsdGVyaW5nXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coJ1tEb2N1bWVudHMgR0VUXSBIZWFkZXJzOicsIE9iamVjdC5mcm9tRW50cmllcyhyZXF1ZXN0LmhlYWRlcnMuZW50cmllcygpKSlcbiAgICBjb25zb2xlLmxvZygnW0RvY3VtZW50cyBHRVRdIEF1dGggaGVhZGVyOicsIHJlcXVlc3QuaGVhZGVycy5nZXQoJ2F1dGhvcml6YXRpb24nKSlcblxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBnZXRBdXRoZW50aWNhdGVkVXNlcihyZXF1ZXN0KVxuXG4gICAgaWYgKCF1c2VyKSB7XG4gICAgICBjb25zb2xlLmxvZygnW0RvY3VtZW50cyBHRVRdIEF1dGhlbnRpY2F0aW9uIGZhaWxlZCcpXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCdbRG9jdW1lbnRzIEdFVF0gVXNlciBhdXRoZW50aWNhdGVkOicsIHVzZXIuZW1haWwpXG5cbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybClcbiAgICBjb25zdCBjYXRlZ29yeUlkID0gc2VhcmNoUGFyYW1zLmdldCgnY2F0ZWdvcnlfaWQnKVxuICAgIGNvbnN0IHN0YXR1cyA9IHNlYXJjaFBhcmFtcy5nZXQoJ3N0YXR1cycpIHx8ICdhY3RpdmUnXG4gICAgY29uc3Qgc2VhcmNoID0gc2VhcmNoUGFyYW1zLmdldCgnc2VhcmNoJylcbiAgICBjb25zdCBwYWdlID0gcGFyc2VJbnQoc2VhcmNoUGFyYW1zLmdldCgncGFnZScpIHx8ICcxJylcbiAgICBjb25zdCBsaW1pdCA9IHBhcnNlSW50KHNlYXJjaFBhcmFtcy5nZXQoJ2xpbWl0JykgfHwgJzUwJylcbiAgICBjb25zdCBvZmZzZXQgPSAocGFnZSAtIDEpICogbGltaXRcblxuICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlU2VydmVyQ2xpZW50KClcblxuICAgIC8vIEJ1aWxkIHF1ZXJ5IC0gZmlsdGVyIGJ5IHVzZXJfaWQgb3IgdXBsb2FkZWRfYnkgdG8gZW5zdXJlIHVzZXJzIG9ubHkgc2VlIHRoZWlyIG93biBkb2N1bWVudHNcbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZVxuICAgICAgLmZyb20oJ2RvY3VtZW50cycpXG4gICAgICAuc2VsZWN0KGBcbiAgICAgICAgKixcbiAgICAgICAgY2F0ZWdvcmllczpjYXRlZ29yeV9pZCAoXG4gICAgICAgICAgaWQsXG4gICAgICAgICAgbmFtZSxcbiAgICAgICAgICBkZXNjcmlwdGlvblxuICAgICAgICApLFxuICAgICAgICB1cGxvYWRlcjp1cGxvYWRlZF9ieSAoXG4gICAgICAgICAgaWQsXG4gICAgICAgICAgbmFtZSxcbiAgICAgICAgICBlbWFpbFxuICAgICAgICApXG4gICAgICBgLCB7IGNvdW50OiAnZXhhY3QnIH0pXG4gICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcbiAgICAgIC5yYW5nZShvZmZzZXQsIG9mZnNldCArIGxpbWl0IC0gMSlcblxuICAgIC8vIENSSVRJQ0FMOiBGaWx0ZXIgYnkgdXNlciB0byBlbnN1cmUgdXNlcnMgb25seSBzZWUgdGhlaXIgb3duIGRvY3VtZW50c1xuICAgIC8vIENoZWNrIGJvdGggdXNlcl9pZCBhbmQgdXBsb2FkZWRfYnkgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHlcbiAgICAvLyBVc2UgLm9yKCkgd2l0aCBwcm9wZXIgZm9ybWF0XG4gICAgcXVlcnkgPSBxdWVyeS5vcihgdXNlcl9pZC5lcS4ke3VzZXIuaWR9LHVwbG9hZGVkX2J5LmVxLiR7dXNlci5pZH1gKVxuXG4gICAgLy8gQXBwbHkgZmlsdGVyc1xuICAgIGlmIChzdGF0dXMpIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3N0YXR1cycsIHN0YXR1cylcbiAgICB9XG5cbiAgICBpZiAoY2F0ZWdvcnlJZCkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY2F0ZWdvcnlfaWQnLCBjYXRlZ29yeUlkKVxuICAgIH1cblxuICAgIGlmIChzZWFyY2gpIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkub3IoYG5hbWUuaWxpa2UuJSR7c2VhcmNofSUsZGVzY3JpcHRpb24uaWxpa2UuJSR7c2VhcmNofSVgKVxuICAgIH1cblxuICAgIC8vIE5vbi1hZG1pbnMgY2FuIG9ubHkgc2VlIGFjdGl2ZSBkb2N1bWVudHNcbiAgICBpZiAodXNlci5yb2xlICE9PSAnYWRtaW4nKSB7XG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdzdGF0dXMnLCAnYWN0aXZlJylcbiAgICB9XG5cbiAgICBjb25zdCB7IGRhdGE6IGRvY3VtZW50cywgZXJyb3IsIGNvdW50IH0gPSBhd2FpdCBxdWVyeVxuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdHZXQgZG9jdW1lbnRzIGVycm9yOicsIGVycm9yKVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnRmFpbGVkIHRvIGZldGNoIGRvY3VtZW50cycgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkb2N1bWVudHM6IGRvY3VtZW50cyB8fCBbXSxcbiAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgcGFnZSxcbiAgICAgICAgbGltaXQsXG4gICAgICAgIHRvdGFsOiBjb3VudCB8fCAwLFxuICAgICAgICB0b3RhbFBhZ2VzOiBNYXRoLmNlaWwoKGNvdW50IHx8IDApIC8gbGltaXQpLFxuICAgICAgfSxcbiAgICB9KVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0dldCBkb2N1bWVudHMgZXJyb3I6JywgZXJyb3IpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgIClcbiAgfVxufVxuXG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiY3JlYXRlU2VydmVyQ2xpZW50IiwiZ2V0QXV0aGVudGljYXRlZFVzZXIiLCJsb2dBY3Rpb24iLCJnZXRDbGllbnRJcCIsInJhbmRvbVVVSUQiLCJQT1NUIiwicmVxdWVzdCIsImNvbnNvbGUiLCJsb2ciLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImhlYWRlcnMiLCJlbnRyaWVzIiwiZ2V0IiwidXNlciIsImpzb24iLCJlcnJvciIsInN0YXR1cyIsImVtYWlsIiwic3VwYWJhc2UiLCJmb3JtRGF0YSIsIkFycmF5IiwiZnJvbSIsImtleXMiLCJmb3JtRGF0YUVycm9yIiwiZmlsZSIsIm5hbWUiLCJkZXNjcmlwdGlvbiIsImNhdGVnb3J5X2lkIiwidGFnc1N0cmluZyIsInR5cGUiLCJzaXplIiwidGFncyIsInNwbGl0IiwibWFwIiwidCIsInRyaW0iLCJmaWx0ZXIiLCJmaWxlRXh0ZW5zaW9uIiwicG9wIiwidW5pcXVlRmlsZW5hbWUiLCJidWNrZXROYW1lIiwiZmlsZUJ1ZmZlciIsIkZpbGUiLCJhcnJheUJ1ZmZlciIsImJ5dGVMZW5ndGgiLCJidWZmZXJFcnJvciIsImlkIiwiZGF0YSIsInVwbG9hZERhdGEiLCJ1cGxvYWRFcnJvciIsInN0b3JhZ2UiLCJ1cGxvYWQiLCJjYWNoZUNvbnRyb2wiLCJ1cHNlcnQiLCJjb250ZW50VHlwZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJtZXNzYWdlIiwiZG9jdW1lbnQiLCJkb2NFcnJvciIsImluc2VydCIsImZpbGVfcGF0aCIsImZpbGVfc2l6ZSIsImZpbGVfdHlwZSIsInVzZXJfaWQiLCJ1cGxvYWRlZF9ieSIsInZlcnNpb24iLCJzZWxlY3QiLCJzaW5nbGUiLCJyZW1vdmUiLCJjbGVhbnVwRXJyb3IiLCJzdWNjZXNzIiwiRXJyb3IiLCJzdGFjayIsIlN0cmluZyIsImRldGFpbHMiLCJwcm9jZXNzIiwidW5kZWZpbmVkIiwiR0VUIiwic2VhcmNoUGFyYW1zIiwiVVJMIiwidXJsIiwiY2F0ZWdvcnlJZCIsInNlYXJjaCIsInBhZ2UiLCJwYXJzZUludCIsImxpbWl0Iiwib2Zmc2V0IiwicXVlcnkiLCJjb3VudCIsIm9yZGVyIiwiYXNjZW5kaW5nIiwicmFuZ2UiLCJvciIsImVxIiwicm9sZSIsImRvY3VtZW50cyIsInBhZ2luYXRpb24iLCJ0b3RhbCIsInRvdGFsUGFnZXMiLCJNYXRoIiwiY2VpbCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/documents/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth-helpers.ts":
/*!*****************************!*\
  !*** ./lib/auth-helpers.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getAuthenticatedUser: () => (/* binding */ getAuthenticatedUser),\n/* harmony export */   getAuthenticatedUserFromSession: () => (/* binding */ getAuthenticatedUserFromSession),\n/* harmony export */   getClientIp: () => (/* binding */ getClientIp),\n/* harmony export */   isAdmin: () => (/* binding */ isAdmin),\n/* harmony export */   logAction: () => (/* binding */ logAction)\n/* harmony export */ });\n/* harmony import */ var _supabase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./supabase */ \"(rsc)/./lib/supabase.ts\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/index.mjs\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jsonwebtoken */ \"(rsc)/./node_modules/jsonwebtoken/index.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__);\n\n\n\n/**\n * Create a Supabase client for token validation\n * Uses anon key for validating user tokens (service role key bypasses auth checks)\n */ function createAuthClient() {\n    const supabaseUrl = \"https://owwuktgpundilqkdbvxj.supabase.co\";\n    const supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im93d3VrdGdwdW5kaWxxa2RidnhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ5MTY5NTMsImV4cCI6MjA4MDQ5Mjk1M30.rt3AkjsQrEjbZImOGlcVLLYS1-WbHtit7Zu7hkEJn4s\";\n    if (!supabaseUrl || !supabaseAnonKey) {\n        throw new Error(\"Missing Supabase environment variables for auth\");\n    }\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__.createClient)(supabaseUrl, supabaseAnonKey, {\n        auth: {\n            autoRefreshToken: false,\n            persistSession: false\n        }\n    });\n}\n/**\n * Get authenticated user from JWT token in Authorization header or httpOnly cookie\n * Tries Supabase session token validation first (for Supabase Auth tokens),\n * then falls back to custom JWT verification (for JWTs signed with JWT_SECRET)\n * This supports both Supabase Auth tokens and custom JWTs\n */ async function getAuthenticatedUser(request) {\n    try {\n        let token = null;\n        // First, try to get token from Authorization header\n        const authHeader = request.headers.get(\"authorization\");\n        if (authHeader && authHeader.startsWith(\"Bearer \")) {\n            token = authHeader.replace(\"Bearer \", \"\").trim();\n        }\n        // If no token in header, try to get from httpOnly cookie (for iframe authentication)\n        if (!token) {\n            // Try both cookie names for compatibility\n            const accessTokenCookie = request.cookies.get(\"accessToken\")?.value;\n            const tokenCookie = request.cookies.get(\"token\")?.value;\n            if (accessTokenCookie) {\n                token = accessTokenCookie;\n                console.log(\"[Auth] Using accessToken from httpOnly cookie for iframe authentication\");\n            } else if (tokenCookie) {\n                token = tokenCookie;\n                console.log(\"[Auth] Using token from httpOnly cookie for iframe authentication\");\n            }\n        }\n        if (!token || token.length < 20) {\n            console.error(\"[Auth] Missing or invalid token (checked both header and cookie)\");\n            return null;\n        }\n        if (!token || token.length < 20) {\n            console.error(\"[Auth] Invalid token format (too short)\");\n            return null;\n        }\n        // First, try Supabase session token validation (for Supabase Auth tokens)\n        // Use anon key client for token validation (service role bypasses auth)\n        try {\n            console.log(\"[Auth] Attempting Supabase token validation...\");\n            const authClient = createAuthClient();\n            const { data: { user: supabaseUser }, error: supabaseError } = await authClient.auth.getUser(token);\n            if (supabaseError) {\n                console.log(\"[Auth] Supabase token validation error:\", supabaseError.message);\n            }\n            if (!supabaseError && supabaseUser) {\n                console.log(\"[Auth] Supabase token validated successfully for user:\", supabaseUser.email);\n                // Token is a valid Supabase token, get user profile using server client\n                // Match strictly by auth user id (UUID), not by email\n                const supabase = (0,_supabase__WEBPACK_IMPORTED_MODULE_0__.createServerClient)();\n                let { data: dbUser, error: dbError } = await supabase.from(\"users\").select(\"id, email, name, role\").eq(\"id\", supabaseUser.id).maybeSingle();\n                // If not found by UUID, try by email as fallback\n                if (!dbUser && !dbError && supabaseUser.email) {\n                    console.log(\"[Auth] User not found by UUID, trying by email:\", supabaseUser.email);\n                    const { data: emailUser, error: emailError } = await supabase.from(\"users\").select(\"id, email, name, role\").eq(\"email\", supabaseUser.email).maybeSingle();\n                    if (!emailError && emailUser) {\n                        console.log(\"[Auth] User found by email\");\n                        dbUser = emailUser;\n                        dbError = null;\n                    }\n                }\n                if (!dbError && dbUser) {\n                    console.log(\"[Auth] User profile retrieved successfully\");\n                    return dbUser;\n                }\n                // User profile not found - try to create it from auth.users data\n                // Only create if no row is found (dbUser is null)\n                if (!dbUser) {\n                    console.log(\"[Auth] User profile not found, attempting to create from auth.users\");\n                    const createdUser = await ensureUserProfileExists(supabaseUser.id, supabaseUser.email, supabaseUser.user_metadata);\n                    if (createdUser) {\n                        return createdUser;\n                    }\n                }\n                if (dbError) {\n                    console.error(\"[Auth] Error retrieving user from database:\", dbError.message, \"User ID:\", supabaseUser.id);\n                }\n            } else if (supabaseError) {\n                console.error(\"[Auth] Supabase token validation failed:\", supabaseError.message, supabaseError.status);\n            }\n        } catch (supabaseAuthError) {\n            console.error(\"[Auth] Supabase auth client error:\", supabaseAuthError);\n        }\n        // Fallback: Try custom JWT verification (for custom JWTs signed with JWT_SECRET)\n        // This maintains backward compatibility for custom tokens\n        const jwtSecret = process.env.JWT_SECRET;\n        if (jwtSecret) {\n            try {\n                const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().verify(token, jwtSecret);\n                const userId = decoded.sub || decoded.user_id || decoded.id;\n                if (userId) {\n                    console.log(\"[Auth] Custom JWT validated successfully for user ID:\", userId);\n                    const supabase = (0,_supabase__WEBPACK_IMPORTED_MODULE_0__.createServerClient)();\n                    const { data: dbUser, error } = await supabase.from(\"users\").select(\"id, email, name, role\").eq(\"id\", userId).maybeSingle();\n                    if (!error && dbUser) {\n                        console.log(\"[Auth] User profile retrieved from custom JWT\");\n                        return dbUser;\n                    }\n                }\n            } catch (jwtError) {\n                // JWT verification failed - this is expected if it's a Supabase token\n                if (jwtError instanceof (jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().JsonWebTokenError)) {\n                    console.error(\"[Auth] Custom JWT verification failed:\", jwtError.message);\n                }\n            }\n        } else {\n            console.warn(\"[Auth] JWT_SECRET not configured - custom JWT verification disabled\");\n        }\n        // If both methods failed, return null\n        console.error(\"[Auth] All authentication methods failed\");\n        return null;\n    } catch (error) {\n        console.error(\"[Auth] Unexpected auth error:\", error);\n        return null;\n    }\n}\n/**\n * Check if user is admin\n */ function isAdmin(user) {\n    return user?.role === \"admin\";\n}\n/**\n * Log system action\n */ async function logAction(userId, action, resource, status, ipAddress = null) {\n    try {\n        const supabase = (0,_supabase__WEBPACK_IMPORTED_MODULE_0__.createServerClient)();\n        await supabase.from(\"system_logs\").insert({\n            user_id: userId,\n            action,\n            resource,\n            status,\n            ip_address: ipAddress\n        });\n    } catch (error) {\n        console.error(\"Failed to log action:\", error);\n    }\n}\n/**\n * Get authenticated user from Supabase session token\n * This validates the JWT token from Authorization header\n * Uses anon key for token validation (service role bypasses auth checks)\n */ async function getAuthenticatedUserFromSession(request) {\n    try {\n        const authHeader = request.headers.get(\"authorization\");\n        if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n            return null;\n        }\n        const token = authHeader.replace(\"Bearer \", \"\").trim();\n        // Verify token with Supabase using anon key (for proper token validation)\n        const authClient = createAuthClient();\n        const { data: { user }, error } = await authClient.auth.getUser(token);\n        if (error || !user) {\n            console.error(\"[Session Auth] Token validation failed:\", error?.message);\n            return null;\n        }\n        // Get user profile from database using server client (for RLS bypass)\n        // Match strictly by auth user id (UUID), not by email\n        const supabase = (0,_supabase__WEBPACK_IMPORTED_MODULE_0__.createServerClient)();\n        const { data: dbUser, error: dbError } = await supabase.from(\"users\").select(\"id, email, name, role\").eq(\"id\", user.id).maybeSingle();\n        if (!dbError && dbUser) {\n            return dbUser;\n        }\n        // User profile not found - try to create it from auth.users data\n        // Only create if no row is found (dbUser is null)\n        if (!dbUser) {\n            console.log(\"[Session Auth] User profile not found, attempting to create from auth.users\");\n            const createdUser = await ensureUserProfileExists(user.id, user.email, user.user_metadata);\n            if (createdUser) {\n                return createdUser;\n            }\n        }\n        if (dbError) {\n            console.error(\"[Session Auth] Error retrieving user profile:\", dbError.message);\n        }\n        return null;\n    } catch (error) {\n        console.error(\"[Session Auth] Unexpected error:\", error);\n        return null;\n    }\n}\n/**\n * Ensure user profile exists in public.users table\n * Creates the profile if it doesn't exist, using data from auth.users\n * Matches users strictly by auth user id (UUID), not by email\n * Only creates if no row is found - does not attempt insert if user already exists\n * Returns the user profile or null if creation fails\n */ async function ensureUserProfileExists(authUserId, authUserEmail, authUserMetadata) {\n    try {\n        const supabase = (0,_supabase__WEBPACK_IMPORTED_MODULE_0__.createServerClient)();\n        // Check if user already exists - match strictly by auth user id (UUID)\n        const { data: existingUser, error: checkError } = await supabase.from(\"users\").select(\"id, email, name, role\").eq(\"id\", authUserId).maybeSingle();\n        // If user exists, return it immediately\n        if (!checkError && existingUser) {\n            return existingUser;\n        }\n        // Only create if no row is found (existingUser is null)\n        // Do not attempt to insert if user already exists\n        if (existingUser) {\n            console.log(\"[Auth] User profile already exists, skipping creation\");\n            return null;\n        }\n        // User doesn't exist, create it\n        console.log(\"[Auth] User profile not found, creating from auth.users data:\", authUserId);\n        const userName = authUserMetadata?.full_name || authUserMetadata?.name || authUserEmail?.split(\"@\")[0] || \"User\";\n        const userRole = authUserMetadata?.role || \"user\";\n        const { data: newUser, error: createError } = await supabase.from(\"users\").insert({\n            id: authUserId,\n            email: authUserEmail || \"\",\n            name: userName,\n            role: userRole\n        }).select(\"id, email, name, role\").maybeSingle();\n        if (createError) {\n            // Handle duplicate key errors (user was created between check and insert)\n            if (createError.code === \"23505\") {\n                // User was created by another process (trigger or concurrent request), fetch it\n                console.log(\"[Auth] User profile was created concurrently, fetching existing record\");\n                const { data: fetchedUser, error: fetchError } = await supabase.from(\"users\").select(\"id, email, name, role\").eq(\"id\", authUserId).maybeSingle();\n                if (!fetchError && fetchedUser) {\n                    return fetchedUser;\n                }\n            }\n            // Handle duplicate email errors gracefully (shouldn't happen with UUID matching, but handle it)\n            if (createError.code === \"23505\" && createError.message?.includes(\"email\")) {\n                console.warn(\"[Auth] Duplicate email detected, but user lookup by UUID should prevent this\");\n                // Try to fetch by UUID instead\n                const { data: fetchedUser, error: fetchError } = await supabase.from(\"users\").select(\"id, email, name, role\").eq(\"id\", authUserId).maybeSingle();\n                if (!fetchError && fetchedUser) {\n                    return fetchedUser;\n                }\n            }\n            console.error(\"[Auth] Failed to create user profile:\", createError.message, \"Code:\", createError.code);\n            return null;\n        }\n        if (newUser) {\n            console.log(\"[Auth] User profile created successfully:\", newUser.email);\n            return newUser;\n        }\n        // If insert succeeded but no data returned, try fetching\n        const { data: fetchedUser, error: fetchError } = await supabase.from(\"users\").select(\"id, email, name, role\").eq(\"id\", authUserId).maybeSingle();\n        if (!fetchError && fetchedUser) {\n            return fetchedUser;\n        }\n        return null;\n    } catch (error) {\n        console.error(\"[Auth] Error ensuring user profile exists:\", error);\n        return null;\n    }\n}\n/**\n * Get client IP address from request\n */ function getClientIp(request) {\n    const forwarded = request.headers.get(\"x-forwarded-for\");\n    const realIp = request.headers.get(\"x-real-ip\");\n    if (forwarded) {\n        return forwarded.split(\",\")[0].trim();\n    }\n    return realIp || null;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LE1BQU13RSxTQUFTNUUsUUFBUUcsT0FBTyxDQUFDQyxHQUFHLENBQUM7SUFFbkMsSUFBSXVFLFdBQVc7UUFDYixPQUFPQSxVQUFVVCxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQzNELElBQUk7SUFDckM7SUFFQSxPQUFPcUUsVUFBVTtBQUNuQiIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL2xpYi9hdXRoLWhlbHBlcnMudHM/OTQwMyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCB9IGZyb20gJ25leHQvc2VydmVyJ1xuaW1wb3J0IHsgY3JlYXRlU2VydmVyQ2xpZW50IH0gZnJvbSAnLi9zdXBhYmFzZSdcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcydcbmltcG9ydCBqd3QgZnJvbSAnanNvbndlYnRva2VuJ1xuXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhlbnRpY2F0ZWRVc2VyIHtcbiAgaWQ6IHN0cmluZ1xuICBlbWFpbDogc3RyaW5nXG4gIG5hbWU6IHN0cmluZ1xuICByb2xlOiAndXNlcicgfCAnYWRtaW4nXG59XG5cbi8qKlxuICogQ3JlYXRlIGEgU3VwYWJhc2UgY2xpZW50IGZvciB0b2tlbiB2YWxpZGF0aW9uXG4gKiBVc2VzIGFub24ga2V5IGZvciB2YWxpZGF0aW5nIHVzZXIgdG9rZW5zIChzZXJ2aWNlIHJvbGUga2V5IGJ5cGFzc2VzIGF1dGggY2hlY2tzKVxuICovXG5mdW5jdGlvbiBjcmVhdGVBdXRoQ2xpZW50KCkge1xuICBjb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTFxuICBjb25zdCBzdXBhYmFzZUFub25LZXkgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWVxuXG4gIGlmICghc3VwYWJhc2VVcmwgfHwgIXN1cGFiYXNlQW5vbktleSkge1xuICAgIHRocm93IG5ldyBFcnJvcignTWlzc2luZyBTdXBhYmFzZSBlbnZpcm9ubWVudCB2YXJpYWJsZXMgZm9yIGF1dGgnKVxuICB9XG5cbiAgcmV0dXJuIGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5LCB7XG4gICAgYXV0aDoge1xuICAgICAgYXV0b1JlZnJlc2hUb2tlbjogZmFsc2UsXG4gICAgICBwZXJzaXN0U2Vzc2lvbjogZmFsc2UsXG4gICAgfSxcbiAgfSlcbn1cblxuLyoqXG4gKiBHZXQgYXV0aGVudGljYXRlZCB1c2VyIGZyb20gSldUIHRva2VuIGluIEF1dGhvcml6YXRpb24gaGVhZGVyIG9yIGh0dHBPbmx5IGNvb2tpZVxuICogVHJpZXMgU3VwYWJhc2Ugc2Vzc2lvbiB0b2tlbiB2YWxpZGF0aW9uIGZpcnN0IChmb3IgU3VwYWJhc2UgQXV0aCB0b2tlbnMpLFxuICogdGhlbiBmYWxscyBiYWNrIHRvIGN1c3RvbSBKV1QgdmVyaWZpY2F0aW9uIChmb3IgSldUcyBzaWduZWQgd2l0aCBKV1RfU0VDUkVUKVxuICogVGhpcyBzdXBwb3J0cyBib3RoIFN1cGFiYXNlIEF1dGggdG9rZW5zIGFuZCBjdXN0b20gSldUc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QXV0aGVudGljYXRlZFVzZXIoXG4gIHJlcXVlc3Q6IE5leHRSZXF1ZXN0XG4pOiBQcm9taXNlPEF1dGhlbnRpY2F0ZWRVc2VyIHwgbnVsbD4ge1xuICB0cnkge1xuICAgIGxldCB0b2tlbjogc3RyaW5nIHwgbnVsbCA9IG51bGxcblxuICAgIC8vIEZpcnN0LCB0cnkgdG8gZ2V0IHRva2VuIGZyb20gQXV0aG9yaXphdGlvbiBoZWFkZXJcbiAgICBjb25zdCBhdXRoSGVhZGVyID0gcmVxdWVzdC5oZWFkZXJzLmdldCgnYXV0aG9yaXphdGlvbicpXG4gICAgaWYgKGF1dGhIZWFkZXIgJiYgYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcbiAgICAgIHRva2VuID0gYXV0aEhlYWRlci5yZXBsYWNlKCdCZWFyZXIgJywgJycpLnRyaW0oKVxuICAgIH1cblxuICAgIC8vIElmIG5vIHRva2VuIGluIGhlYWRlciwgdHJ5IHRvIGdldCBmcm9tIGh0dHBPbmx5IGNvb2tpZSAoZm9yIGlmcmFtZSBhdXRoZW50aWNhdGlvbilcbiAgICBpZiAoIXRva2VuKSB7XG4gICAgICAvLyBUcnkgYm90aCBjb29raWUgbmFtZXMgZm9yIGNvbXBhdGliaWxpdHlcbiAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuQ29va2llID0gcmVxdWVzdC5jb29raWVzLmdldCgnYWNjZXNzVG9rZW4nKT8udmFsdWVcbiAgICAgIGNvbnN0IHRva2VuQ29va2llID0gcmVxdWVzdC5jb29raWVzLmdldCgndG9rZW4nKT8udmFsdWVcblxuICAgICAgaWYgKGFjY2Vzc1Rva2VuQ29va2llKSB7XG4gICAgICAgIHRva2VuID0gYWNjZXNzVG9rZW5Db29raWVcbiAgICAgICAgY29uc29sZS5sb2coJ1tBdXRoXSBVc2luZyBhY2Nlc3NUb2tlbiBmcm9tIGh0dHBPbmx5IGNvb2tpZSBmb3IgaWZyYW1lIGF1dGhlbnRpY2F0aW9uJylcbiAgICAgIH0gZWxzZSBpZiAodG9rZW5Db29raWUpIHtcbiAgICAgICAgdG9rZW4gPSB0b2tlbkNvb2tpZVxuICAgICAgICBjb25zb2xlLmxvZygnW0F1dGhdIFVzaW5nIHRva2VuIGZyb20gaHR0cE9ubHkgY29va2llIGZvciBpZnJhbWUgYXV0aGVudGljYXRpb24nKVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghdG9rZW4gfHwgdG9rZW4ubGVuZ3RoIDwgMjApIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tBdXRoXSBNaXNzaW5nIG9yIGludmFsaWQgdG9rZW4gKGNoZWNrZWQgYm90aCBoZWFkZXIgYW5kIGNvb2tpZSknKVxuICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG4gICAgXG4gICAgaWYgKCF0b2tlbiB8fCB0b2tlbi5sZW5ndGggPCAyMCkge1xuICAgICAgY29uc29sZS5lcnJvcignW0F1dGhdIEludmFsaWQgdG9rZW4gZm9ybWF0ICh0b28gc2hvcnQpJylcbiAgICAgIHJldHVybiBudWxsXG4gICAgfVxuXG4gICAgLy8gRmlyc3QsIHRyeSBTdXBhYmFzZSBzZXNzaW9uIHRva2VuIHZhbGlkYXRpb24gKGZvciBTdXBhYmFzZSBBdXRoIHRva2VucylcbiAgICAvLyBVc2UgYW5vbiBrZXkgY2xpZW50IGZvciB0b2tlbiB2YWxpZGF0aW9uIChzZXJ2aWNlIHJvbGUgYnlwYXNzZXMgYXV0aClcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coJ1tBdXRoXSBBdHRlbXB0aW5nIFN1cGFiYXNlIHRva2VuIHZhbGlkYXRpb24uLi4nKVxuICAgICAgY29uc3QgYXV0aENsaWVudCA9IGNyZWF0ZUF1dGhDbGllbnQoKVxuICAgICAgY29uc3QgeyBkYXRhOiB7IHVzZXI6IHN1cGFiYXNlVXNlciB9LCBlcnJvcjogc3VwYWJhc2VFcnJvciB9ID0gYXdhaXQgYXV0aENsaWVudC5hdXRoLmdldFVzZXIodG9rZW4pXG5cbiAgICAgIGlmIChzdXBhYmFzZUVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbQXV0aF0gU3VwYWJhc2UgdG9rZW4gdmFsaWRhdGlvbiBlcnJvcjonLCBzdXBhYmFzZUVycm9yLm1lc3NhZ2UpXG4gICAgICB9XG5cbiAgICAgIGlmICghc3VwYWJhc2VFcnJvciAmJiBzdXBhYmFzZVVzZXIpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1tBdXRoXSBTdXBhYmFzZSB0b2tlbiB2YWxpZGF0ZWQgc3VjY2Vzc2Z1bGx5IGZvciB1c2VyOicsIHN1cGFiYXNlVXNlci5lbWFpbClcbiAgICAgICAgXG4gICAgICAgIC8vIFRva2VuIGlzIGEgdmFsaWQgU3VwYWJhc2UgdG9rZW4sIGdldCB1c2VyIHByb2ZpbGUgdXNpbmcgc2VydmVyIGNsaWVudFxuICAgICAgICAvLyBNYXRjaCBzdHJpY3RseSBieSBhdXRoIHVzZXIgaWQgKFVVSUQpLCBub3QgYnkgZW1haWxcbiAgICAgICAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVTZXJ2ZXJDbGllbnQoKVxuICAgICAgICBsZXQgeyBkYXRhOiBkYlVzZXIsIGVycm9yOiBkYkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgIC5mcm9tKCd1c2VycycpXG4gICAgICAgICAgLnNlbGVjdCgnaWQsIGVtYWlsLCBuYW1lLCByb2xlJylcbiAgICAgICAgICAuZXEoJ2lkJywgc3VwYWJhc2VVc2VyLmlkKVxuICAgICAgICAgIC5tYXliZVNpbmdsZSgpXG5cbiAgICAgICAgLy8gSWYgbm90IGZvdW5kIGJ5IFVVSUQsIHRyeSBieSBlbWFpbCBhcyBmYWxsYmFja1xuICAgICAgICBpZiAoIWRiVXNlciAmJiAhZGJFcnJvciAmJiBzdXBhYmFzZVVzZXIuZW1haWwpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnW0F1dGhdIFVzZXIgbm90IGZvdW5kIGJ5IFVVSUQsIHRyeWluZyBieSBlbWFpbDonLCBzdXBhYmFzZVVzZXIuZW1haWwpXG4gICAgICAgICAgY29uc3QgeyBkYXRhOiBlbWFpbFVzZXIsIGVycm9yOiBlbWFpbEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgICAgLmZyb20oJ3VzZXJzJylcbiAgICAgICAgICAgIC5zZWxlY3QoJ2lkLCBlbWFpbCwgbmFtZSwgcm9sZScpXG4gICAgICAgICAgICAuZXEoJ2VtYWlsJywgc3VwYWJhc2VVc2VyLmVtYWlsKVxuICAgICAgICAgICAgLm1heWJlU2luZ2xlKClcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoIWVtYWlsRXJyb3IgJiYgZW1haWxVc2VyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW0F1dGhdIFVzZXIgZm91bmQgYnkgZW1haWwnKVxuICAgICAgICAgICAgZGJVc2VyID0gZW1haWxVc2VyXG4gICAgICAgICAgICBkYkVycm9yID0gbnVsbFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghZGJFcnJvciAmJiBkYlVzZXIpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnW0F1dGhdIFVzZXIgcHJvZmlsZSByZXRyaWV2ZWQgc3VjY2Vzc2Z1bGx5JylcbiAgICAgICAgICByZXR1cm4gZGJVc2VyIGFzIEF1dGhlbnRpY2F0ZWRVc2VyXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIFVzZXIgcHJvZmlsZSBub3QgZm91bmQgLSB0cnkgdG8gY3JlYXRlIGl0IGZyb20gYXV0aC51c2VycyBkYXRhXG4gICAgICAgIC8vIE9ubHkgY3JlYXRlIGlmIG5vIHJvdyBpcyBmb3VuZCAoZGJVc2VyIGlzIG51bGwpXG4gICAgICAgIGlmICghZGJVc2VyKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1tBdXRoXSBVc2VyIHByb2ZpbGUgbm90IGZvdW5kLCBhdHRlbXB0aW5nIHRvIGNyZWF0ZSBmcm9tIGF1dGgudXNlcnMnKVxuICAgICAgICAgIGNvbnN0IGNyZWF0ZWRVc2VyID0gYXdhaXQgZW5zdXJlVXNlclByb2ZpbGVFeGlzdHMoXG4gICAgICAgICAgICBzdXBhYmFzZVVzZXIuaWQsXG4gICAgICAgICAgICBzdXBhYmFzZVVzZXIuZW1haWwsXG4gICAgICAgICAgICBzdXBhYmFzZVVzZXIudXNlcl9tZXRhZGF0YVxuICAgICAgICAgIClcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoY3JlYXRlZFVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBjcmVhdGVkVXNlclxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYgKGRiRXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdbQXV0aF0gRXJyb3IgcmV0cmlldmluZyB1c2VyIGZyb20gZGF0YWJhc2U6JywgZGJFcnJvci5tZXNzYWdlLCAnVXNlciBJRDonLCBzdXBhYmFzZVVzZXIuaWQpXG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoc3VwYWJhc2VFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbQXV0aF0gU3VwYWJhc2UgdG9rZW4gdmFsaWRhdGlvbiBmYWlsZWQ6Jywgc3VwYWJhc2VFcnJvci5tZXNzYWdlLCBzdXBhYmFzZUVycm9yLnN0YXR1cylcbiAgICAgIH1cbiAgICB9IGNhdGNoIChzdXBhYmFzZUF1dGhFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignW0F1dGhdIFN1cGFiYXNlIGF1dGggY2xpZW50IGVycm9yOicsIHN1cGFiYXNlQXV0aEVycm9yKVxuICAgIH1cblxuICAgIC8vIEZhbGxiYWNrOiBUcnkgY3VzdG9tIEpXVCB2ZXJpZmljYXRpb24gKGZvciBjdXN0b20gSldUcyBzaWduZWQgd2l0aCBKV1RfU0VDUkVUKVxuICAgIC8vIFRoaXMgbWFpbnRhaW5zIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgZm9yIGN1c3RvbSB0b2tlbnNcbiAgICBjb25zdCBqd3RTZWNyZXQgPSBwcm9jZXNzLmVudi5KV1RfU0VDUkVUXG4gICAgaWYgKGp3dFNlY3JldCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZGVjb2RlZCA9IGp3dC52ZXJpZnkodG9rZW4sIGp3dFNlY3JldCkgYXMgand0Lkp3dFBheWxvYWRcbiAgICAgICAgY29uc3QgdXNlcklkID0gZGVjb2RlZC5zdWIgfHwgZGVjb2RlZC51c2VyX2lkIHx8IGRlY29kZWQuaWRcblxuICAgICAgICBpZiAodXNlcklkKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1tBdXRoXSBDdXN0b20gSldUIHZhbGlkYXRlZCBzdWNjZXNzZnVsbHkgZm9yIHVzZXIgSUQ6JywgdXNlcklkKVxuICAgICAgICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlU2VydmVyQ2xpZW50KClcbiAgICAgICAgICBjb25zdCB7IGRhdGE6IGRiVXNlciwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgICAgICAuZnJvbSgndXNlcnMnKVxuICAgICAgICAgICAgLnNlbGVjdCgnaWQsIGVtYWlsLCBuYW1lLCByb2xlJylcbiAgICAgICAgICAgIC5lcSgnaWQnLCB1c2VySWQpXG4gICAgICAgICAgICAubWF5YmVTaW5nbGUoKVxuXG4gICAgICAgICAgaWYgKCFlcnJvciAmJiBkYlVzZXIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbQXV0aF0gVXNlciBwcm9maWxlIHJldHJpZXZlZCBmcm9tIGN1c3RvbSBKV1QnKVxuICAgICAgICAgICAgcmV0dXJuIGRiVXNlciBhcyBBdXRoZW50aWNhdGVkVXNlclxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoand0RXJyb3IpIHtcbiAgICAgICAgLy8gSldUIHZlcmlmaWNhdGlvbiBmYWlsZWQgLSB0aGlzIGlzIGV4cGVjdGVkIGlmIGl0J3MgYSBTdXBhYmFzZSB0b2tlblxuICAgICAgICBpZiAoand0RXJyb3IgaW5zdGFuY2VvZiBqd3QuSnNvbldlYlRva2VuRXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdbQXV0aF0gQ3VzdG9tIEpXVCB2ZXJpZmljYXRpb24gZmFpbGVkOicsIGp3dEVycm9yLm1lc3NhZ2UpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKCdbQXV0aF0gSldUX1NFQ1JFVCBub3QgY29uZmlndXJlZCAtIGN1c3RvbSBKV1QgdmVyaWZpY2F0aW9uIGRpc2FibGVkJylcbiAgICB9XG5cbiAgICAvLyBJZiBib3RoIG1ldGhvZHMgZmFpbGVkLCByZXR1cm4gbnVsbFxuICAgIGNvbnNvbGUuZXJyb3IoJ1tBdXRoXSBBbGwgYXV0aGVudGljYXRpb24gbWV0aG9kcyBmYWlsZWQnKVxuICAgIHJldHVybiBudWxsXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW0F1dGhdIFVuZXhwZWN0ZWQgYXV0aCBlcnJvcjonLCBlcnJvcilcbiAgICByZXR1cm4gbnVsbFxuICB9XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgdXNlciBpcyBhZG1pblxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNBZG1pbih1c2VyOiBBdXRoZW50aWNhdGVkVXNlciB8IG51bGwpOiBib29sZWFuIHtcbiAgcmV0dXJuIHVzZXI/LnJvbGUgPT09ICdhZG1pbidcbn1cblxuLyoqXG4gKiBMb2cgc3lzdGVtIGFjdGlvblxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9nQWN0aW9uKFxuICB1c2VySWQ6IHN0cmluZyB8IG51bGwsXG4gIGFjdGlvbjogc3RyaW5nLFxuICByZXNvdXJjZTogc3RyaW5nIHwgbnVsbCxcbiAgc3RhdHVzOiAnc3VjY2VzcycgfCAnZmFpbGVkJyxcbiAgaXBBZGRyZXNzOiBzdHJpbmcgfCBudWxsID0gbnVsbFxuKTogUHJvbWlzZTx2b2lkPiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVTZXJ2ZXJDbGllbnQoKVxuICAgIGF3YWl0IHN1cGFiYXNlLmZyb20oJ3N5c3RlbV9sb2dzJykuaW5zZXJ0KHtcbiAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgIGFjdGlvbixcbiAgICAgIHJlc291cmNlLFxuICAgICAgc3RhdHVzLFxuICAgICAgaXBfYWRkcmVzczogaXBBZGRyZXNzLFxuICAgIH0pXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGxvZyBhY3Rpb246JywgZXJyb3IpXG4gIH1cbn1cblxuLyoqXG4gKiBHZXQgYXV0aGVudGljYXRlZCB1c2VyIGZyb20gU3VwYWJhc2Ugc2Vzc2lvbiB0b2tlblxuICogVGhpcyB2YWxpZGF0ZXMgdGhlIEpXVCB0b2tlbiBmcm9tIEF1dGhvcml6YXRpb24gaGVhZGVyXG4gKiBVc2VzIGFub24ga2V5IGZvciB0b2tlbiB2YWxpZGF0aW9uIChzZXJ2aWNlIHJvbGUgYnlwYXNzZXMgYXV0aCBjaGVja3MpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBdXRoZW50aWNhdGVkVXNlckZyb21TZXNzaW9uKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTxBdXRoZW50aWNhdGVkVXNlciB8IG51bGw+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBhdXRoSGVhZGVyID0gcmVxdWVzdC5oZWFkZXJzLmdldCgnYXV0aG9yaXphdGlvbicpXG5cbiAgICBpZiAoIWF1dGhIZWFkZXIgfHwgIWF1dGhIZWFkZXIuc3RhcnRzV2l0aCgnQmVhcmVyICcpKSB7XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cblxuICAgIGNvbnN0IHRva2VuID0gYXV0aEhlYWRlci5yZXBsYWNlKCdCZWFyZXIgJywgJycpLnRyaW0oKVxuXG4gICAgLy8gVmVyaWZ5IHRva2VuIHdpdGggU3VwYWJhc2UgdXNpbmcgYW5vbiBrZXkgKGZvciBwcm9wZXIgdG9rZW4gdmFsaWRhdGlvbilcbiAgICBjb25zdCBhdXRoQ2xpZW50ID0gY3JlYXRlQXV0aENsaWVudCgpXG4gICAgY29uc3QgeyBkYXRhOiB7IHVzZXIgfSwgZXJyb3IgfSA9IGF3YWl0IGF1dGhDbGllbnQuYXV0aC5nZXRVc2VyKHRva2VuKVxuXG4gICAgaWYgKGVycm9yIHx8ICF1c2VyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbU2Vzc2lvbiBBdXRoXSBUb2tlbiB2YWxpZGF0aW9uIGZhaWxlZDonLCBlcnJvcj8ubWVzc2FnZSlcbiAgICAgIHJldHVybiBudWxsXG4gICAgfVxuXG4gICAgLy8gR2V0IHVzZXIgcHJvZmlsZSBmcm9tIGRhdGFiYXNlIHVzaW5nIHNlcnZlciBjbGllbnQgKGZvciBSTFMgYnlwYXNzKVxuICAgIC8vIE1hdGNoIHN0cmljdGx5IGJ5IGF1dGggdXNlciBpZCAoVVVJRCksIG5vdCBieSBlbWFpbFxuICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlU2VydmVyQ2xpZW50KClcbiAgICBjb25zdCB7IGRhdGE6IGRiVXNlciwgZXJyb3I6IGRiRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgndXNlcnMnKVxuICAgICAgLnNlbGVjdCgnaWQsIGVtYWlsLCBuYW1lLCByb2xlJylcbiAgICAgIC5lcSgnaWQnLCB1c2VyLmlkKVxuICAgICAgLm1heWJlU2luZ2xlKClcblxuICAgIGlmICghZGJFcnJvciAmJiBkYlVzZXIpIHtcbiAgICAgIHJldHVybiBkYlVzZXIgYXMgQXV0aGVudGljYXRlZFVzZXJcbiAgICB9XG5cbiAgICAvLyBVc2VyIHByb2ZpbGUgbm90IGZvdW5kIC0gdHJ5IHRvIGNyZWF0ZSBpdCBmcm9tIGF1dGgudXNlcnMgZGF0YVxuICAgIC8vIE9ubHkgY3JlYXRlIGlmIG5vIHJvdyBpcyBmb3VuZCAoZGJVc2VyIGlzIG51bGwpXG4gICAgaWYgKCFkYlVzZXIpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdbU2Vzc2lvbiBBdXRoXSBVc2VyIHByb2ZpbGUgbm90IGZvdW5kLCBhdHRlbXB0aW5nIHRvIGNyZWF0ZSBmcm9tIGF1dGgudXNlcnMnKVxuICAgICAgY29uc3QgY3JlYXRlZFVzZXIgPSBhd2FpdCBlbnN1cmVVc2VyUHJvZmlsZUV4aXN0cyhcbiAgICAgICAgdXNlci5pZCxcbiAgICAgICAgdXNlci5lbWFpbCxcbiAgICAgICAgdXNlci51c2VyX21ldGFkYXRhXG4gICAgICApXG4gICAgICBcbiAgICAgIGlmIChjcmVhdGVkVXNlcikge1xuICAgICAgICByZXR1cm4gY3JlYXRlZFVzZXJcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoZGJFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignW1Nlc3Npb24gQXV0aF0gRXJyb3IgcmV0cmlldmluZyB1c2VyIHByb2ZpbGU6JywgZGJFcnJvci5tZXNzYWdlKVxuICAgIH1cbiAgICByZXR1cm4gbnVsbFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tTZXNzaW9uIEF1dGhdIFVuZXhwZWN0ZWQgZXJyb3I6JywgZXJyb3IpXG4gICAgcmV0dXJuIG51bGxcbiAgfVxufVxuXG4vKipcbiAqIEVuc3VyZSB1c2VyIHByb2ZpbGUgZXhpc3RzIGluIHB1YmxpYy51c2VycyB0YWJsZVxuICogQ3JlYXRlcyB0aGUgcHJvZmlsZSBpZiBpdCBkb2Vzbid0IGV4aXN0LCB1c2luZyBkYXRhIGZyb20gYXV0aC51c2Vyc1xuICogTWF0Y2hlcyB1c2VycyBzdHJpY3RseSBieSBhdXRoIHVzZXIgaWQgKFVVSUQpLCBub3QgYnkgZW1haWxcbiAqIE9ubHkgY3JlYXRlcyBpZiBubyByb3cgaXMgZm91bmQgLSBkb2VzIG5vdCBhdHRlbXB0IGluc2VydCBpZiB1c2VyIGFscmVhZHkgZXhpc3RzXG4gKiBSZXR1cm5zIHRoZSB1c2VyIHByb2ZpbGUgb3IgbnVsbCBpZiBjcmVhdGlvbiBmYWlsc1xuICovXG5hc3luYyBmdW5jdGlvbiBlbnN1cmVVc2VyUHJvZmlsZUV4aXN0cyhcbiAgYXV0aFVzZXJJZDogc3RyaW5nLFxuICBhdXRoVXNlckVtYWlsOiBzdHJpbmcgfCB1bmRlZmluZWQsXG4gIGF1dGhVc2VyTWV0YWRhdGE6IFJlY29yZDxzdHJpbmcsIGFueT4gfCB1bmRlZmluZWRcbik6IFByb21pc2U8QXV0aGVudGljYXRlZFVzZXIgfCBudWxsPiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVTZXJ2ZXJDbGllbnQoKVxuXG4gICAgLy8gQ2hlY2sgaWYgdXNlciBhbHJlYWR5IGV4aXN0cyAtIG1hdGNoIHN0cmljdGx5IGJ5IGF1dGggdXNlciBpZCAoVVVJRClcbiAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nVXNlciwgZXJyb3I6IGNoZWNrRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgndXNlcnMnKVxuICAgICAgLnNlbGVjdCgnaWQsIGVtYWlsLCBuYW1lLCByb2xlJylcbiAgICAgIC5lcSgnaWQnLCBhdXRoVXNlcklkKVxuICAgICAgLm1heWJlU2luZ2xlKClcblxuICAgIC8vIElmIHVzZXIgZXhpc3RzLCByZXR1cm4gaXQgaW1tZWRpYXRlbHlcbiAgICBpZiAoIWNoZWNrRXJyb3IgJiYgZXhpc3RpbmdVc2VyKSB7XG4gICAgICByZXR1cm4gZXhpc3RpbmdVc2VyIGFzIEF1dGhlbnRpY2F0ZWRVc2VyXG4gICAgfVxuXG4gICAgLy8gT25seSBjcmVhdGUgaWYgbm8gcm93IGlzIGZvdW5kIChleGlzdGluZ1VzZXIgaXMgbnVsbClcbiAgICAvLyBEbyBub3QgYXR0ZW1wdCB0byBpbnNlcnQgaWYgdXNlciBhbHJlYWR5IGV4aXN0c1xuICAgIGlmIChleGlzdGluZ1VzZXIpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdbQXV0aF0gVXNlciBwcm9maWxlIGFscmVhZHkgZXhpc3RzLCBza2lwcGluZyBjcmVhdGlvbicpXG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cblxuICAgIC8vIFVzZXIgZG9lc24ndCBleGlzdCwgY3JlYXRlIGl0XG4gICAgY29uc29sZS5sb2coJ1tBdXRoXSBVc2VyIHByb2ZpbGUgbm90IGZvdW5kLCBjcmVhdGluZyBmcm9tIGF1dGgudXNlcnMgZGF0YTonLCBhdXRoVXNlcklkKVxuICAgIFxuICAgIGNvbnN0IHVzZXJOYW1lID0gYXV0aFVzZXJNZXRhZGF0YT8uZnVsbF9uYW1lIHx8IFxuICAgICAgICAgICAgICAgICAgICAgYXV0aFVzZXJNZXRhZGF0YT8ubmFtZSB8fCBcbiAgICAgICAgICAgICAgICAgICAgIGF1dGhVc2VyRW1haWw/LnNwbGl0KCdAJylbMF0gfHwgXG4gICAgICAgICAgICAgICAgICAgICAnVXNlcidcbiAgICBcbiAgICBjb25zdCB1c2VyUm9sZSA9IGF1dGhVc2VyTWV0YWRhdGE/LnJvbGUgfHwgJ3VzZXInXG5cbiAgICBjb25zdCB7IGRhdGE6IG5ld1VzZXIsIGVycm9yOiBjcmVhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCd1c2VycycpXG4gICAgICAuaW5zZXJ0KHtcbiAgICAgICAgaWQ6IGF1dGhVc2VySWQsXG4gICAgICAgIGVtYWlsOiBhdXRoVXNlckVtYWlsIHx8ICcnLFxuICAgICAgICBuYW1lOiB1c2VyTmFtZSxcbiAgICAgICAgcm9sZTogdXNlclJvbGUsXG4gICAgICB9KVxuICAgICAgLnNlbGVjdCgnaWQsIGVtYWlsLCBuYW1lLCByb2xlJylcbiAgICAgIC5tYXliZVNpbmdsZSgpXG5cbiAgICBpZiAoY3JlYXRlRXJyb3IpIHtcbiAgICAgIC8vIEhhbmRsZSBkdXBsaWNhdGUga2V5IGVycm9ycyAodXNlciB3YXMgY3JlYXRlZCBiZXR3ZWVuIGNoZWNrIGFuZCBpbnNlcnQpXG4gICAgICBpZiAoY3JlYXRlRXJyb3IuY29kZSA9PT0gJzIzNTA1Jykge1xuICAgICAgICAvLyBVc2VyIHdhcyBjcmVhdGVkIGJ5IGFub3RoZXIgcHJvY2VzcyAodHJpZ2dlciBvciBjb25jdXJyZW50IHJlcXVlc3QpLCBmZXRjaCBpdFxuICAgICAgICBjb25zb2xlLmxvZygnW0F1dGhdIFVzZXIgcHJvZmlsZSB3YXMgY3JlYXRlZCBjb25jdXJyZW50bHksIGZldGNoaW5nIGV4aXN0aW5nIHJlY29yZCcpXG4gICAgICAgIGNvbnN0IHsgZGF0YTogZmV0Y2hlZFVzZXIsIGVycm9yOiBmZXRjaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgIC5mcm9tKCd1c2VycycpXG4gICAgICAgICAgLnNlbGVjdCgnaWQsIGVtYWlsLCBuYW1lLCByb2xlJylcbiAgICAgICAgICAuZXEoJ2lkJywgYXV0aFVzZXJJZClcbiAgICAgICAgICAubWF5YmVTaW5nbGUoKVxuICAgICAgICBcbiAgICAgICAgaWYgKCFmZXRjaEVycm9yICYmIGZldGNoZWRVc2VyKSB7XG4gICAgICAgICAgcmV0dXJuIGZldGNoZWRVc2VyIGFzIEF1dGhlbnRpY2F0ZWRVc2VyXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gSGFuZGxlIGR1cGxpY2F0ZSBlbWFpbCBlcnJvcnMgZ3JhY2VmdWxseSAoc2hvdWxkbid0IGhhcHBlbiB3aXRoIFVVSUQgbWF0Y2hpbmcsIGJ1dCBoYW5kbGUgaXQpXG4gICAgICBpZiAoY3JlYXRlRXJyb3IuY29kZSA9PT0gJzIzNTA1JyAmJiBjcmVhdGVFcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnZW1haWwnKSkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1tBdXRoXSBEdXBsaWNhdGUgZW1haWwgZGV0ZWN0ZWQsIGJ1dCB1c2VyIGxvb2t1cCBieSBVVUlEIHNob3VsZCBwcmV2ZW50IHRoaXMnKVxuICAgICAgICAvLyBUcnkgdG8gZmV0Y2ggYnkgVVVJRCBpbnN0ZWFkXG4gICAgICAgIGNvbnN0IHsgZGF0YTogZmV0Y2hlZFVzZXIsIGVycm9yOiBmZXRjaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgIC5mcm9tKCd1c2VycycpXG4gICAgICAgICAgLnNlbGVjdCgnaWQsIGVtYWlsLCBuYW1lLCByb2xlJylcbiAgICAgICAgICAuZXEoJ2lkJywgYXV0aFVzZXJJZClcbiAgICAgICAgICAubWF5YmVTaW5nbGUoKVxuICAgICAgICBcbiAgICAgICAgaWYgKCFmZXRjaEVycm9yICYmIGZldGNoZWRVc2VyKSB7XG4gICAgICAgICAgcmV0dXJuIGZldGNoZWRVc2VyIGFzIEF1dGhlbnRpY2F0ZWRVc2VyXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc29sZS5lcnJvcignW0F1dGhdIEZhaWxlZCB0byBjcmVhdGUgdXNlciBwcm9maWxlOicsIGNyZWF0ZUVycm9yLm1lc3NhZ2UsICdDb2RlOicsIGNyZWF0ZUVycm9yLmNvZGUpXG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cblxuICAgIGlmIChuZXdVc2VyKSB7XG4gICAgICBjb25zb2xlLmxvZygnW0F1dGhdIFVzZXIgcHJvZmlsZSBjcmVhdGVkIHN1Y2Nlc3NmdWxseTonLCBuZXdVc2VyLmVtYWlsKVxuICAgICAgcmV0dXJuIG5ld1VzZXIgYXMgQXV0aGVudGljYXRlZFVzZXJcbiAgICB9XG5cbiAgICAvLyBJZiBpbnNlcnQgc3VjY2VlZGVkIGJ1dCBubyBkYXRhIHJldHVybmVkLCB0cnkgZmV0Y2hpbmdcbiAgICBjb25zdCB7IGRhdGE6IGZldGNoZWRVc2VyLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCd1c2VycycpXG4gICAgICAuc2VsZWN0KCdpZCwgZW1haWwsIG5hbWUsIHJvbGUnKVxuICAgICAgLmVxKCdpZCcsIGF1dGhVc2VySWQpXG4gICAgICAubWF5YmVTaW5nbGUoKVxuXG4gICAgaWYgKCFmZXRjaEVycm9yICYmIGZldGNoZWRVc2VyKSB7XG4gICAgICByZXR1cm4gZmV0Y2hlZFVzZXIgYXMgQXV0aGVudGljYXRlZFVzZXJcbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tBdXRoXSBFcnJvciBlbnN1cmluZyB1c2VyIHByb2ZpbGUgZXhpc3RzOicsIGVycm9yKVxuICAgIHJldHVybiBudWxsXG4gIH1cbn1cblxuLyoqXG4gKiBHZXQgY2xpZW50IElQIGFkZHJlc3MgZnJvbSByZXF1ZXN0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRDbGllbnRJcChyZXF1ZXN0OiBOZXh0UmVxdWVzdCk6IHN0cmluZyB8IG51bGwge1xuICBjb25zdCBmb3J3YXJkZWQgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd4LWZvcndhcmRlZC1mb3InKVxuICBjb25zdCByZWFsSXAgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd4LXJlYWwtaXAnKVxuXG4gIGlmIChmb3J3YXJkZWQpIHtcbiAgICByZXR1cm4gZm9yd2FyZGVkLnNwbGl0KCcsJylbMF0udHJpbSgpXG4gIH1cblxuICByZXR1cm4gcmVhbElwIHx8IG51bGxcbn1cblxuIl0sIm5hbWVzIjpbImNyZWF0ZVNlcnZlckNsaWVudCIsImNyZWF0ZUNsaWVudCIsImp3dCIsImNyZWF0ZUF1dGhDbGllbnQiLCJzdXBhYmFzZVVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzdXBhYmFzZUFub25LZXkiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsIkVycm9yIiwiYXV0aCIsImF1dG9SZWZyZXNoVG9rZW4iLCJwZXJzaXN0U2Vzc2lvbiIsImdldEF1dGhlbnRpY2F0ZWRVc2VyIiwicmVxdWVzdCIsInRva2VuIiwiYXV0aEhlYWRlciIsImhlYWRlcnMiLCJnZXQiLCJzdGFydHNXaXRoIiwicmVwbGFjZSIsInRyaW0iLCJhY2Nlc3NUb2tlbkNvb2tpZSIsImNvb2tpZXMiLCJ2YWx1ZSIsInRva2VuQ29va2llIiwiY29uc29sZSIsImxvZyIsImxlbmd0aCIsImVycm9yIiwiYXV0aENsaWVudCIsImRhdGEiLCJ1c2VyIiwic3VwYWJhc2VVc2VyIiwic3VwYWJhc2VFcnJvciIsImdldFVzZXIiLCJtZXNzYWdlIiwiZW1haWwiLCJzdXBhYmFzZSIsImRiVXNlciIsImRiRXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJpZCIsIm1heWJlU2luZ2xlIiwiZW1haWxVc2VyIiwiZW1haWxFcnJvciIsImNyZWF0ZWRVc2VyIiwiZW5zdXJlVXNlclByb2ZpbGVFeGlzdHMiLCJ1c2VyX21ldGFkYXRhIiwic3RhdHVzIiwic3VwYWJhc2VBdXRoRXJyb3IiLCJqd3RTZWNyZXQiLCJKV1RfU0VDUkVUIiwiZGVjb2RlZCIsInZlcmlmeSIsInVzZXJJZCIsInN1YiIsInVzZXJfaWQiLCJqd3RFcnJvciIsIkpzb25XZWJUb2tlbkVycm9yIiwid2FybiIsImlzQWRtaW4iLCJyb2xlIiwibG9nQWN0aW9uIiwiYWN0aW9uIiwicmVzb3VyY2UiLCJpcEFkZHJlc3MiLCJpbnNlcnQiLCJpcF9hZGRyZXNzIiwiZ2V0QXV0aGVudGljYXRlZFVzZXJGcm9tU2Vzc2lvbiIsImF1dGhVc2VySWQiLCJhdXRoVXNlckVtYWlsIiwiYXV0aFVzZXJNZXRhZGF0YSIsImV4aXN0aW5nVXNlciIsImNoZWNrRXJyb3IiLCJ1c2VyTmFtZSIsImZ1bGxfbmFtZSIsIm5hbWUiLCJzcGxpdCIsInVzZXJSb2xlIiwibmV3VXNlciIsImNyZWF0ZUVycm9yIiwiY29kZSIsImZldGNoZWRVc2VyIiwiZmV0Y2hFcnJvciIsImluY2x1ZGVzIiwiZ2V0Q2xpZW50SXAiLCJmb3J3YXJkZWQiLCJyZWFsSXAiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth-helpers.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase.ts":
/*!*************************!*\
  !*** ./lib/supabase.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createBrowserClient: () => (/* binding */ createBrowserClient),\n/* harmony export */   createServerClient: () => (/* binding */ createServerClient),\n/* harmony export */   getFreshServerClient: () => (/* binding */ getFreshServerClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/index.mjs\");\n\n/**\r\n * Server-side Supabase client with connection pooling\r\n * Uses service role key for admin operations and bypasses RLS\r\n * Configured to use pooled connections and avoid schema cache issues\r\n */ function createServerClient() {\n    const supabaseUrl = \"https://owwuktgpundilqkdbvxj.supabase.co\";\n    const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n    if (!supabaseUrl || !supabaseServiceKey) {\n        throw new Error(\"Missing Supabase environment variables\");\n    }\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseServiceKey, {\n        auth: {\n            autoRefreshToken: false,\n            persistSession: false\n        },\n        db: {\n            schema: \"public\"\n        },\n        global: {\n            headers: {\n                \"x-client-info\": \"rdms-server-pooled\",\n                \"Prefer\": \"return=representation\"\n            }\n        }\n    });\n}\n/**\r\n * Client-side Supabase client with connection pooling\r\n * Uses anon key and respects RLS policies\r\n */ function createBrowserClient() {\n    const supabaseUrl = \"https://owwuktgpundilqkdbvxj.supabase.co\";\n    const supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im93d3VrdGdwdW5kaWxxa2RidnhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ5MTY5NTMsImV4cCI6MjA4MDQ5Mjk1M30.rt3AkjsQrEjbZImOGlcVLLYS1-WbHtit7Zu7hkEJn4s\";\n    if (!supabaseUrl || !supabaseAnonKey) {\n        throw new Error(\"Missing Supabase environment variables\");\n    }\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseAnonKey, {\n        db: {\n            schema: \"public\"\n        },\n        global: {\n            headers: {\n                \"x-client-info\": \"rdms-browser-pooled\"\n            }\n        }\n    });\n}\n/**\r\n * Get a fresh client instance to avoid connection reuse issues\r\n * Useful when you need to ensure a new connection\r\n */ function getFreshServerClient() {\n    return createServerClient();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFvRTtBQUVwRTs7OztDQUlDLEdBQ00sU0FBU0M7SUFDZCxNQUFNQyxjQUFjQywwQ0FBb0M7SUFDeEQsTUFBTUcscUJBQXFCSCxRQUFRQyxHQUFHLENBQUNHLHlCQUF5QjtJQUVoRSxJQUFJLENBQUNMLGVBQWUsQ0FBQ0ksb0JBQW9CO1FBQ3ZDLE1BQU0sSUFBSUUsTUFBTTtJQUNsQjtJQUVBLE9BQU9SLG1FQUFZQSxDQUFDRSxhQUFhSSxvQkFBb0I7UUFDbkRHLE1BQU07WUFDSkMsa0JBQWtCO1lBQ2xCQyxnQkFBZ0I7UUFDbEI7UUFDQUMsSUFBSTtZQUNGQyxRQUFRO1FBQ1Y7UUFDQUMsUUFBUTtZQUNOQyxTQUFTO2dCQUNQLGlCQUFpQjtnQkFDakIsVUFBVTtZQUNaO1FBR0Y7SUFDRjtBQUNGO0FBRUE7OztDQUdDLEdBQ00sU0FBU0M7SUFDZCxNQUFNZCxjQUFjQywwQ0FBb0M7SUFDeEQsTUFBTWMsa0JBQWtCZCxrTkFBeUM7SUFFakUsSUFBSSxDQUFDRCxlQUFlLENBQUNlLGlCQUFpQjtRQUNwQyxNQUFNLElBQUlULE1BQU07SUFDbEI7SUFFQSxPQUFPUixtRUFBWUEsQ0FBQ0UsYUFBYWUsaUJBQWlCO1FBQ2hETCxJQUFJO1lBQ0ZDLFFBQVE7UUFDVjtRQUNBQyxRQUFRO1lBQ05DLFNBQVM7Z0JBQ1AsaUJBQWlCO1lBQ25CO1FBRUY7SUFDRjtBQUNGO0FBRUE7OztDQUdDLEdBQ00sU0FBU0k7SUFDZCxPQUFPbEI7QUFDVCIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL2xpYi9zdXBhYmFzZS50cz9jOTlmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNsaWVudCwgU3VwYWJhc2VDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnXHJcblxyXG4vKipcclxuICogU2VydmVyLXNpZGUgU3VwYWJhc2UgY2xpZW50IHdpdGggY29ubmVjdGlvbiBwb29saW5nXHJcbiAqIFVzZXMgc2VydmljZSByb2xlIGtleSBmb3IgYWRtaW4gb3BlcmF0aW9ucyBhbmQgYnlwYXNzZXMgUkxTXHJcbiAqIENvbmZpZ3VyZWQgdG8gdXNlIHBvb2xlZCBjb25uZWN0aW9ucyBhbmQgYXZvaWQgc2NoZW1hIGNhY2hlIGlzc3Vlc1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVNlcnZlckNsaWVudCgpOiBTdXBhYmFzZUNsaWVudCB7XHJcbiAgY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkxcclxuICBjb25zdCBzdXBhYmFzZVNlcnZpY2VLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZXHJcblxyXG4gIGlmICghc3VwYWJhc2VVcmwgfHwgIXN1cGFiYXNlU2VydmljZUtleSkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIFN1cGFiYXNlIGVudmlyb25tZW50IHZhcmlhYmxlcycpXHJcbiAgfVxyXG5cclxuICByZXR1cm4gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZVNlcnZpY2VLZXksIHtcclxuICAgIGF1dGg6IHtcclxuICAgICAgYXV0b1JlZnJlc2hUb2tlbjogZmFsc2UsXHJcbiAgICAgIHBlcnNpc3RTZXNzaW9uOiBmYWxzZSxcclxuICAgIH0sXHJcbiAgICBkYjoge1xyXG4gICAgICBzY2hlbWE6ICdwdWJsaWMnLFxyXG4gICAgfSxcclxuICAgIGdsb2JhbDoge1xyXG4gICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgJ3gtY2xpZW50LWluZm8nOiAncmRtcy1zZXJ2ZXItcG9vbGVkJyxcclxuICAgICAgICAnUHJlZmVyJzogJ3JldHVybj1yZXByZXNlbnRhdGlvbicsXHJcbiAgICAgIH0sXHJcbiAgICAgIC8vIFVzZSBkZWZhdWx0IGZldGNoIC0gZG9uJ3Qgb3ZlcnJpZGUgdG8gYXZvaWQgaGVhZGVyIGNvbmZsaWN0cyB3aXRoIHVuZGljaVxyXG4gICAgICAvLyBDYWNoZS1idXN0aW5nIGFuZCBjb25uZWN0aW9uIHBvb2xpbmcgYXJlIGhhbmRsZWQgYXV0b21hdGljYWxseVxyXG4gICAgfSxcclxuICB9KVxyXG59XHJcblxyXG4vKipcclxuICogQ2xpZW50LXNpZGUgU3VwYWJhc2UgY2xpZW50IHdpdGggY29ubmVjdGlvbiBwb29saW5nXHJcbiAqIFVzZXMgYW5vbiBrZXkgYW5kIHJlc3BlY3RzIFJMUyBwb2xpY2llc1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUJyb3dzZXJDbGllbnQoKTogU3VwYWJhc2VDbGllbnQge1xyXG4gIGNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMXHJcbiAgY29uc3Qgc3VwYWJhc2VBbm9uS2V5ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVlcclxuXHJcbiAgaWYgKCFzdXBhYmFzZVVybCB8fCAhc3VwYWJhc2VBbm9uS2V5KSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgU3VwYWJhc2UgZW52aXJvbm1lbnQgdmFyaWFibGVzJylcclxuICB9XHJcblxyXG4gIHJldHVybiBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSwge1xyXG4gICAgZGI6IHtcclxuICAgICAgc2NoZW1hOiAncHVibGljJyxcclxuICAgIH0sXHJcbiAgICBnbG9iYWw6IHtcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICd4LWNsaWVudC1pbmZvJzogJ3JkbXMtYnJvd3Nlci1wb29sZWQnLFxyXG4gICAgICB9LFxyXG4gICAgICAvLyBVc2UgZGVmYXVsdCBmZXRjaCAtIG5vIGN1c3RvbSBoZWFkZXJzIG5lZWRlZFxyXG4gICAgfSxcclxuICB9KVxyXG59XHJcblxyXG4vKipcclxuICogR2V0IGEgZnJlc2ggY2xpZW50IGluc3RhbmNlIHRvIGF2b2lkIGNvbm5lY3Rpb24gcmV1c2UgaXNzdWVzXHJcbiAqIFVzZWZ1bCB3aGVuIHlvdSBuZWVkIHRvIGVuc3VyZSBhIG5ldyBjb25uZWN0aW9uXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RnJlc2hTZXJ2ZXJDbGllbnQoKTogU3VwYWJhc2VDbGllbnQge1xyXG4gIHJldHVybiBjcmVhdGVTZXJ2ZXJDbGllbnQoKVxyXG59XHJcblxyXG4iXSwibmFtZXMiOlsiY3JlYXRlQ2xpZW50IiwiY3JlYXRlU2VydmVyQ2xpZW50Iiwic3VwYWJhc2VVcmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwic3VwYWJhc2VTZXJ2aWNlS2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsIkVycm9yIiwiYXV0aCIsImF1dG9SZWZyZXNoVG9rZW4iLCJwZXJzaXN0U2Vzc2lvbiIsImRiIiwic2NoZW1hIiwiZ2xvYmFsIiwiaGVhZGVycyIsImNyZWF0ZUJyb3dzZXJDbGllbnQiLCJzdXBhYmFzZUFub25LZXkiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsImdldEZyZXNoU2VydmVyQ2xpZW50Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@supabase","vendor-chunks/next","vendor-chunks/tslib","vendor-chunks/iceberg-js","vendor-chunks/semver","vendor-chunks/jsonwebtoken","vendor-chunks/lodash.includes","vendor-chunks/jws","vendor-chunks/lodash.once","vendor-chunks/jwa","vendor-chunks/lodash.isinteger","vendor-chunks/ecdsa-sig-formatter","vendor-chunks/lodash.isplainobject","vendor-chunks/ms","vendor-chunks/lodash.isstring","vendor-chunks/lodash.isnumber","vendor-chunks/lodash.isboolean","vendor-chunks/safe-buffer","vendor-chunks/buffer-equal-constant-time"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdocuments%2Froute&page=%2Fapi%2Fdocuments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdocuments%2Froute.ts&appDir=C%3A%5CUsers%5Caksha%5CDocuments%5CGitHub%5Csalak%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Caksha%5CDocuments%5CGitHub%5Csalak&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();