"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/auth/login/route";
exports.ids = ["app/api/auth/login/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2Flogin%2Froute&page=%2Fapi%2Fauth%2Flogin%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Flogin%2Froute.ts&appDir=C%3A%5CUsers%5Caksha%5CDocuments%5CGitHub%5Csalak%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Caksha%5CDocuments%5CGitHub%5Csalak&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2Flogin%2Froute&page=%2Fapi%2Fauth%2Flogin%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Flogin%2Froute.ts&appDir=C%3A%5CUsers%5Caksha%5CDocuments%5CGitHub%5Csalak%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Caksha%5CDocuments%5CGitHub%5Csalak&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_aksha_Documents_GitHub_salak_app_api_auth_login_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/auth/login/route.ts */ \"(rsc)/./app/api/auth/login/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/auth/login/route\",\n        pathname: \"/api/auth/login\",\n        filename: \"route\",\n        bundlePath: \"app/api/auth/login/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\aksha\\\\Documents\\\\GitHub\\\\salak\\\\app\\\\api\\\\auth\\\\login\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_aksha_Documents_GitHub_salak_app_api_auth_login_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/auth/login/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhdXRoJTJGbG9naW4lMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmF1dGglMkZsb2dpbiUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmF1dGglMkZsb2dpbiUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNha3NoYSU1Q0RvY3VtZW50cyU1Q0dpdEh1YiU1Q3NhbGFrJTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1DJTNBJTVDVXNlcnMlNUNha3NoYSU1Q0RvY3VtZW50cyU1Q0dpdEh1YiU1Q3NhbGFrJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUMyQjtBQUN4RztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovLy8/YmQyYiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxVc2Vyc1xcXFxha3NoYVxcXFxEb2N1bWVudHNcXFxcR2l0SHViXFxcXHNhbGFrXFxcXGFwcFxcXFxhcGlcXFxcYXV0aFxcXFxsb2dpblxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvYXV0aC9sb2dpbi9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2F1dGgvbG9naW5cIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2F1dGgvbG9naW4vcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxha3NoYVxcXFxEb2N1bWVudHNcXFxcR2l0SHViXFxcXHNhbGFrXFxcXGFwcFxcXFxhcGlcXFxcYXV0aFxcXFxsb2dpblxcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvYXV0aC9sb2dpbi9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2Flogin%2Froute&page=%2Fapi%2Fauth%2Flogin%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Flogin%2Froute.ts&appDir=C%3A%5CUsers%5Caksha%5CDocuments%5CGitHub%5Csalak%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Caksha%5CDocuments%5CGitHub%5Csalak&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/auth/login/route.ts":
/*!*************************************!*\
  !*** ./app/api/auth/login/route.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/index.mjs\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bcryptjs */ \"(rsc)/./node_modules/bcryptjs/index.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(bcryptjs__WEBPACK_IMPORTED_MODULE_1__);\n\n\n\nasync function POST(request) {\n    try {\n        const { email, password } = await request.json();\n        if (!email || !password) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Email and password are required\"\n            }, {\n                status: 400\n            });\n        }\n        // Normalize email\n        const normalizedEmail = email.toLowerCase().trim();\n        // Create Supabase client for auth operations\n        const supabaseUrl = \"https://owwuktgpundilqkdbvxj.supabase.co\";\n        const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n        console.log(\"[Login Debug] Environment check:\", {\n            hasSupabaseUrl: !!supabaseUrl,\n            hasServiceKey: !!supabaseServiceKey,\n            serviceKeyLength: supabaseServiceKey?.length,\n            serviceKeyPrefix: supabaseServiceKey?.substring(0, 20) + \"...\"\n        });\n        if (!supabaseUrl || !supabaseServiceKey) {\n            console.error(\"[Login Debug] Missing Supabase environment variables\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Server configuration error\"\n            }, {\n                status: 500\n            });\n        }\n        const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__.createClient)(supabaseUrl, supabaseServiceKey, {\n            auth: {\n                autoRefreshToken: false,\n                persistSession: false\n            }\n        });\n        // Test basic connectivity\n        console.log(\"[Login Debug] Testing basic Supabase connectivity...\");\n        try {\n            const { data: testData, error: testError } = await supabase.from(\"users\").select(\"count\").limit(1);\n            console.log(\"[Login Debug] Basic connectivity test:\", {\n                success: !testError,\n                error: testError,\n                data: testData\n            });\n        } catch (connectError) {\n            console.error(\"[Login Debug] Basic connectivity failed:\", connectError);\n        }\n        // Verify service role key is working by testing basic connectivity\n        console.log(\"[Login Debug] Testing Supabase client connectivity...\");\n        try {\n            const { data: testData, error: testError } = await supabase.from(\"users\").select(\"id\").limit(1);\n            console.log(\"[Login Debug] Basic connectivity test:\", {\n                success: !testError,\n                error: testError?.message,\n                hasData: !!testData\n            });\n        } catch (connectError) {\n            console.error(\"[Login Debug] Supabase client connection failed:\", connectError);\n        }\n        // Debug log for admin login attempts\n        const isAdminAttempt = normalizedEmail.includes(\"admin\") || normalizedEmail.includes(\"Admin\");\n        if (isAdminAttempt) {\n            console.log(\"[Admin Login] Starting admin login attempt for:\", normalizedEmail);\n        }\n        // Initialize mutable variables for authentication flow\n        let authenticatedUser = null;\n        let authMethod = \"supabase\";\n        let authSession = null;\n        // First, try Supabase Auth sign in\n        console.log(\"[Login] Attempting Supabase Auth login for:\", normalizedEmail);\n        const { data: supabaseData, error: supabaseError } = await supabase.auth.signInWithPassword({\n            email: normalizedEmail,\n            password\n        });\n        if (supabaseError || !supabaseData?.user) {\n            // Supabase auth failed, try custom authentication\n            if (isAdminAttempt) {\n                console.log(\"[Admin Login] Supabase Auth failed, trying custom authentication:\", supabaseError?.message);\n            }\n            console.log(\"[Login] Supabase Auth failed, trying custom authentication:\", supabaseError?.message);\n            // Fallback to custom authentication using password_hash in users table\n            if (isAdminAttempt) {\n                console.log(\"[Admin Login] Querying database for admin user:\", normalizedEmail);\n            }\n            // First test: Simple query to check table access\n            console.log(\"[Login Debug] Testing basic users table access...\");\n            const { data: basicTest, error: basicError } = await supabase.from(\"users\").select(\"id\").limit(1);\n            console.log(\"[Login Debug] Basic table test result:\", {\n                success: !basicError,\n                error: basicError ? {\n                    message: basicError.message,\n                    code: basicError.code,\n                    details: basicError.details,\n                    hint: basicError.hint,\n                    fullError: basicError\n                } : null,\n                hasData: !!basicTest\n            });\n            // Second test: Check table schema\n            console.log(\"[Login Debug] Checking users table schema...\");\n            try {\n                const { data: schemaData, error: schemaError } = await supabase.rpc(\"exec_sql\", {\n                    sql: `\n              SELECT column_name, data_type, is_nullable\n              FROM information_schema.columns\n              WHERE table_name = 'users'\n              AND table_schema = 'public'\n              ORDER BY ordinal_position;\n            `\n                });\n                console.log(\"[Login Debug] Table schema result:\", {\n                    success: !schemaError,\n                    columns: schemaData,\n                    error: schemaError ? {\n                        message: schemaError.message,\n                        code: schemaError.code,\n                        fullError: schemaError\n                    } : null\n                });\n            } catch (schemaErr) {\n                console.log(\"[Login Debug] Schema check failed:\", schemaErr instanceof Error ? schemaErr.message : String(schemaErr));\n            }\n            // Test query with RLS disabled (for debugging)\n            console.log(\"[Login Debug] Testing query with RLS bypass...\");\n            try {\n                const { data: rlsTest, error: rlsError } = await supabase.rpc(\"exec_sql\", {\n                    sql: `SELECT id, email, name, role FROM users WHERE email = '${normalizedEmail.replace(/'/g, \"''\")}' LIMIT 1;`\n                });\n                console.log(\"[Login Debug] RLS bypass test result:\", {\n                    success: !rlsError,\n                    data: rlsTest,\n                    error: rlsError ? {\n                        message: rlsError.message,\n                        code: rlsError.code,\n                        fullError: rlsError\n                    } : null\n                });\n            } catch (rlsErr) {\n                console.log(\"[Login Debug] RLS bypass test failed:\", rlsErr instanceof Error ? rlsErr.message : String(rlsErr));\n            }\n            // Now try the actual query\n            console.log(\"[Login Debug] Executing actual user lookup query...\");\n            const queryStart = Date.now();\n            const { data: userData, error: userError } = await supabase.from(\"users\").select(\"id, email, name, role, password_hash\").eq(\"email\", normalizedEmail).maybeSingle();\n            const queryEnd = Date.now();\n            console.log(\"[Login Debug] Query execution time:\", queryEnd - queryStart, \"ms\");\n            console.log(\"[Login Debug] Query result:\", {\n                hasData: !!userData,\n                dataKeys: userData ? Object.keys(userData) : null,\n                error: userError ? {\n                    message: userError.message,\n                    code: userError.code,\n                    details: userError.details,\n                    hint: userError.hint,\n                    fullError: userError\n                } : null\n            });\n            if (userError) {\n                console.error(\"[Login] FULL DATABASE ERROR during custom auth:\", {\n                    message: userError.message,\n                    code: userError.code,\n                    details: userError.details,\n                    hint: userError.hint,\n                    email: normalizedEmail,\n                    table: \"users\",\n                    operation: \"SELECT with password_hash\",\n                    fullErrorObject: userError,\n                    supabaseUrl: supabaseUrl?.substring(0, 30) + \"...\",\n                    hasServiceKey: !!supabaseServiceKey\n                });\n                if (isAdminAttempt) {\n                    console.error(\"[Admin Login] FULL DATABASE ERROR for admin login:\", {\n                        message: userError.message,\n                        code: userError.code,\n                        details: userError.details,\n                        hint: userError.hint,\n                        email: normalizedEmail,\n                        fullErrorObject: userError\n                    });\n                }\n                // Check for specific error types\n                if (userError.code === \"PGRST116\" || userError.message?.includes('relation \"public.users\" does not exist')) {\n                    console.error(\"[Login] Users table does not exist! Run database setup first.\");\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: \"Database not initialized. Please run database setup.\"\n                    }, {\n                        status: 503\n                    });\n                }\n                if (userError.code === \"PGRST205\" || userError.message?.includes(\"permission denied\")) {\n                    console.error(\"[Login] Permission denied accessing users table. Check RLS policies.\");\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: \"Database permission error. Contact administrator.\"\n                    }, {\n                        status: 503\n                    });\n                }\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Authentication service temporarily unavailable\",\n                    details:  true ? {\n                        dbError: userError.message,\n                        code: userError.code,\n                        table: \"users\",\n                        operation: \"SELECT with password_hash\"\n                    } : 0\n                }, {\n                    status: 503\n                });\n            }\n            if (!userData) {\n                if (isAdminAttempt) {\n                    console.log(\"[Admin Login] Admin user not found in database:\", normalizedEmail);\n                }\n                console.log(\"[Login] User not found in database:\", normalizedEmail);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Invalid email or password\"\n                }, {\n                    status: 401\n                });\n            }\n            if (!userData.password_hash) {\n                if (isAdminAttempt) {\n                    console.log(\"[Admin Login] Admin user has no password hash:\", userData.email, \"Role:\", userData.role);\n                }\n                console.log(\"[Login] User has no password hash:\", userData.email);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Invalid email or password\"\n                }, {\n                    status: 401\n                });\n            }\n            // Verify password using bcrypt\n            if (isAdminAttempt) {\n                console.log(\"[Admin Login] Verifying password hash for admin user:\", userData.email, \"Role:\", userData.role);\n            }\n            console.log(\"[Login] Verifying password hash for user:\", userData.email);\n            const isPasswordValid = await bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().compare(password, userData.password_hash);\n            if (!isPasswordValid) {\n                if (isAdminAttempt) {\n                    console.log(\"[Admin Login] Password verification failed for admin user:\", userData.email);\n                }\n                console.log(\"[Login] Password verification failed for user:\", userData.email);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Invalid email or password\"\n                }, {\n                    status: 401\n                });\n            }\n            // Custom authentication successful\n            authenticatedUser = userData;\n            authMethod = \"custom\";\n            authSession = {\n                access_token: `custom_${userData.id}_${Date.now()}`,\n                refresh_token: null,\n                expires_at: Math.floor(Date.now() / 1000) + 60 * 60 * 24 * 7\n            };\n            if (isAdminAttempt) {\n                console.log(\"[Admin Login] Custom authentication successful for admin user:\", userData.email, \"Role:\", userData.role);\n            }\n            console.log(\"[Login] Custom authentication successful for user:\", userData.email, \"Role:\", userData.role);\n        } else {\n            // Supabase authentication successful\n            console.log(\"[Login] Supabase Auth successful for user:\", supabaseData.user.email);\n            authenticatedUser = supabaseData.user;\n            authSession = supabaseData.session;\n            if (isAdminAttempt) {\n                console.log(\"[Admin Login] Supabase Auth successful for admin user:\", supabaseData.user.email);\n            }\n            // For Supabase auth, check if email is confirmed\n            if (!supabaseData.user.email_confirmed_at) {\n                console.log(\"[Login] Email not confirmed for Supabase user:\", supabaseData.user.email);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Please confirm your email address before signing in. Check your email for a confirmation link.\",\n                    code: \"EMAIL_NOT_CONFIRMED\",\n                    hint: \"Click the confirmation link in your email, then try signing in again.\"\n                }, {\n                    status: 401\n                });\n            }\n        }\n        if (!authenticatedUser) {\n            console.error(\"[Login] No user data after authentication\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Authentication failed\"\n            }, {\n                status: 401\n            });\n        }\n        // Get user profile data\n        let userProfile = null;\n        if (authMethod === \"supabase\") {\n            console.log(\"[Login] Fetching user profile for Supabase user:\", authenticatedUser.id);\n            const { data: profileData, error: profileError } = await supabase.from(\"users\").select(\"id, email, name, role\").eq(\"id\", authenticatedUser.id).single();\n            if (profileError) {\n                console.error(\"[Login] Profile fetch error:\", profileError);\n                // Still return success but with basic user data from auth\n                const supabaseUser = authenticatedUser// Type assertion for Supabase user\n                ;\n                userProfile = {\n                    id: supabaseUser.id,\n                    email: supabaseUser.email,\n                    name: supabaseUser.user_metadata?.full_name || supabaseUser.user_metadata?.name || \"User\",\n                    role: supabaseUser.user_metadata?.role || \"user\"\n                };\n            } else {\n                userProfile = profileData;\n            }\n        } else {\n            // For custom auth, we already have the user profile\n            userProfile = authenticatedUser;\n        }\n        if (isAdminAttempt) {\n            console.log(\"[Admin Login] Final admin user profile:\", userProfile.email, \"Role:\", userProfile.role, \"Auth method:\", authMethod);\n        }\n        console.log(\"[Login] Final user profile:\", userProfile.email, \"Role:\", userProfile.role);\n        // Create unified auth response\n        const authResponse = {\n            success: true,\n            user: userProfile,\n            session: {\n                access_token: authSession?.access_token,\n                refresh_token: authSession?.refresh_token,\n                expires_at: authSession?.expires_at\n            },\n            auth_method: authMethod // Include auth method for debugging\n        };\n        // Set httpOnly cookie for iframe authentication\n        const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(authResponse);\n        // Set httpOnly cookie with JWT token for iframe authentication\n        if (authSession?.access_token) {\n            console.log(\"[Login] Setting accessToken cookie for iframe authentication\");\n            response.cookies.set(\"accessToken\", authSession.access_token, {\n                httpOnly: true,\n                secure: false,\n                sameSite: \"lax\",\n                maxAge: 60 * 60 * 24 * 7,\n                path: \"/\"\n            });\n        }\n        return response;\n    } catch (error) {\n        console.error(\"Login error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\",\n            ... true && {\n                details: error instanceof Error ? error.message : \"Unknown error\"\n            }\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFDNUN1QyxTQUFTN0MsaUJBQWlCc0QsUUFBUXRELE1BQU0rQixPQUFPLEdBQUc7WUFDcEQsQ0FBQztRQUNILEdBQ0E7WUFBRTlCLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXBwL2FwaS9hdXRoL2xvZ2luL3JvdXRlLnRzPzRmMjQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJ1xuaW1wb3J0IGJjcnlwdCBmcm9tICdiY3J5cHRqcydcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGVtYWlsLCBwYXNzd29yZCB9ID0gYXdhaXQgcmVxdWVzdC5qc29uKClcblxuICAgIGlmICghZW1haWwgfHwgIXBhc3N3b3JkKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdFbWFpbCBhbmQgcGFzc3dvcmQgYXJlIHJlcXVpcmVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICAvLyBOb3JtYWxpemUgZW1haWxcbiAgICBjb25zdCBub3JtYWxpemVkRW1haWwgPSBlbWFpbC50b0xvd2VyQ2FzZSgpLnRyaW0oKVxuXG4gICAgLy8gQ3JlYXRlIFN1cGFiYXNlIGNsaWVudCBmb3IgYXV0aCBvcGVyYXRpb25zXG4gICAgY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkxcbiAgICBjb25zdCBzdXBhYmFzZVNlcnZpY2VLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZXG5cbiAgICBjb25zb2xlLmxvZygnW0xvZ2luIERlYnVnXSBFbnZpcm9ubWVudCBjaGVjazonLCB7XG4gICAgICBoYXNTdXBhYmFzZVVybDogISFzdXBhYmFzZVVybCxcbiAgICAgIGhhc1NlcnZpY2VLZXk6ICEhc3VwYWJhc2VTZXJ2aWNlS2V5LFxuICAgICAgc2VydmljZUtleUxlbmd0aDogc3VwYWJhc2VTZXJ2aWNlS2V5Py5sZW5ndGgsXG4gICAgICBzZXJ2aWNlS2V5UHJlZml4OiBzdXBhYmFzZVNlcnZpY2VLZXk/LnN1YnN0cmluZygwLCAyMCkgKyAnLi4uJ1xuICAgIH0pXG5cbiAgICBpZiAoIXN1cGFiYXNlVXJsIHx8ICFzdXBhYmFzZVNlcnZpY2VLZXkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tMb2dpbiBEZWJ1Z10gTWlzc2luZyBTdXBhYmFzZSBlbnZpcm9ubWVudCB2YXJpYWJsZXMnKVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnU2VydmVyIGNvbmZpZ3VyYXRpb24gZXJyb3InIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZVNlcnZpY2VLZXksIHtcbiAgICAgIGF1dGg6IHtcbiAgICAgICAgYXV0b1JlZnJlc2hUb2tlbjogZmFsc2UsXG4gICAgICAgIHBlcnNpc3RTZXNzaW9uOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgfSlcblxuICAgIC8vIFRlc3QgYmFzaWMgY29ubmVjdGl2aXR5XG4gICAgY29uc29sZS5sb2coJ1tMb2dpbiBEZWJ1Z10gVGVzdGluZyBiYXNpYyBTdXBhYmFzZSBjb25uZWN0aXZpdHkuLi4nKVxuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGRhdGE6IHRlc3REYXRhLCBlcnJvcjogdGVzdEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgndXNlcnMnKVxuICAgICAgICAuc2VsZWN0KCdjb3VudCcpXG4gICAgICAgIC5saW1pdCgxKVxuXG4gICAgICBjb25zb2xlLmxvZygnW0xvZ2luIERlYnVnXSBCYXNpYyBjb25uZWN0aXZpdHkgdGVzdDonLCB7XG4gICAgICAgIHN1Y2Nlc3M6ICF0ZXN0RXJyb3IsXG4gICAgICAgIGVycm9yOiB0ZXN0RXJyb3IsXG4gICAgICAgIGRhdGE6IHRlc3REYXRhXG4gICAgICB9KVxuICAgIH0gY2F0Y2ggKGNvbm5lY3RFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignW0xvZ2luIERlYnVnXSBCYXNpYyBjb25uZWN0aXZpdHkgZmFpbGVkOicsIGNvbm5lY3RFcnJvcilcbiAgICB9XG5cbiAgICAvLyBWZXJpZnkgc2VydmljZSByb2xlIGtleSBpcyB3b3JraW5nIGJ5IHRlc3RpbmcgYmFzaWMgY29ubmVjdGl2aXR5XG4gICAgY29uc29sZS5sb2coJ1tMb2dpbiBEZWJ1Z10gVGVzdGluZyBTdXBhYmFzZSBjbGllbnQgY29ubmVjdGl2aXR5Li4uJylcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBkYXRhOiB0ZXN0RGF0YSwgZXJyb3I6IHRlc3RFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3VzZXJzJylcbiAgICAgICAgLnNlbGVjdCgnaWQnKVxuICAgICAgICAubGltaXQoMSlcblxuICAgICAgY29uc29sZS5sb2coJ1tMb2dpbiBEZWJ1Z10gQmFzaWMgY29ubmVjdGl2aXR5IHRlc3Q6Jywge1xuICAgICAgICBzdWNjZXNzOiAhdGVzdEVycm9yLFxuICAgICAgICBlcnJvcjogdGVzdEVycm9yPy5tZXNzYWdlLFxuICAgICAgICBoYXNEYXRhOiAhIXRlc3REYXRhXG4gICAgICB9KVxuICAgIH0gY2F0Y2ggKGNvbm5lY3RFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignW0xvZ2luIERlYnVnXSBTdXBhYmFzZSBjbGllbnQgY29ubmVjdGlvbiBmYWlsZWQ6JywgY29ubmVjdEVycm9yKVxuICAgIH1cblxuICAgIC8vIERlYnVnIGxvZyBmb3IgYWRtaW4gbG9naW4gYXR0ZW1wdHNcbiAgICBjb25zdCBpc0FkbWluQXR0ZW1wdCA9IG5vcm1hbGl6ZWRFbWFpbC5pbmNsdWRlcygnYWRtaW4nKSB8fCBub3JtYWxpemVkRW1haWwuaW5jbHVkZXMoJ0FkbWluJylcbiAgICBpZiAoaXNBZG1pbkF0dGVtcHQpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdbQWRtaW4gTG9naW5dIFN0YXJ0aW5nIGFkbWluIGxvZ2luIGF0dGVtcHQgZm9yOicsIG5vcm1hbGl6ZWRFbWFpbClcbiAgICB9XG5cbiAgICAvLyBJbml0aWFsaXplIG11dGFibGUgdmFyaWFibGVzIGZvciBhdXRoZW50aWNhdGlvbiBmbG93XG4gICAgbGV0IGF1dGhlbnRpY2F0ZWRVc2VyID0gbnVsbFxuICAgIGxldCBhdXRoTWV0aG9kID0gJ3N1cGFiYXNlJ1xuICAgIGxldCBhdXRoU2Vzc2lvbiA9IG51bGxcblxuICAgIC8vIEZpcnN0LCB0cnkgU3VwYWJhc2UgQXV0aCBzaWduIGluXG4gICAgY29uc29sZS5sb2coJ1tMb2dpbl0gQXR0ZW1wdGluZyBTdXBhYmFzZSBBdXRoIGxvZ2luIGZvcjonLCBub3JtYWxpemVkRW1haWwpXG4gICAgY29uc3QgeyBkYXRhOiBzdXBhYmFzZURhdGEsIGVycm9yOiBzdXBhYmFzZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLnNpZ25JbldpdGhQYXNzd29yZCh7XG4gICAgICBlbWFpbDogbm9ybWFsaXplZEVtYWlsLFxuICAgICAgcGFzc3dvcmQsXG4gICAgfSlcblxuICAgIGlmIChzdXBhYmFzZUVycm9yIHx8ICFzdXBhYmFzZURhdGE/LnVzZXIpIHtcbiAgICAgIC8vIFN1cGFiYXNlIGF1dGggZmFpbGVkLCB0cnkgY3VzdG9tIGF1dGhlbnRpY2F0aW9uXG4gICAgICBpZiAoaXNBZG1pbkF0dGVtcHQpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1tBZG1pbiBMb2dpbl0gU3VwYWJhc2UgQXV0aCBmYWlsZWQsIHRyeWluZyBjdXN0b20gYXV0aGVudGljYXRpb246Jywgc3VwYWJhc2VFcnJvcj8ubWVzc2FnZSlcbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKCdbTG9naW5dIFN1cGFiYXNlIEF1dGggZmFpbGVkLCB0cnlpbmcgY3VzdG9tIGF1dGhlbnRpY2F0aW9uOicsIHN1cGFiYXNlRXJyb3I/Lm1lc3NhZ2UpXG5cbiAgICAgIC8vIEZhbGxiYWNrIHRvIGN1c3RvbSBhdXRoZW50aWNhdGlvbiB1c2luZyBwYXNzd29yZF9oYXNoIGluIHVzZXJzIHRhYmxlXG4gICAgICBpZiAoaXNBZG1pbkF0dGVtcHQpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1tBZG1pbiBMb2dpbl0gUXVlcnlpbmcgZGF0YWJhc2UgZm9yIGFkbWluIHVzZXI6Jywgbm9ybWFsaXplZEVtYWlsKVxuICAgICAgfVxuXG4gICAgICAvLyBGaXJzdCB0ZXN0OiBTaW1wbGUgcXVlcnkgdG8gY2hlY2sgdGFibGUgYWNjZXNzXG4gICAgICBjb25zb2xlLmxvZygnW0xvZ2luIERlYnVnXSBUZXN0aW5nIGJhc2ljIHVzZXJzIHRhYmxlIGFjY2Vzcy4uLicpXG4gICAgICBjb25zdCB7IGRhdGE6IGJhc2ljVGVzdCwgZXJyb3I6IGJhc2ljRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCd1c2VycycpXG4gICAgICAgIC5zZWxlY3QoJ2lkJylcbiAgICAgICAgLmxpbWl0KDEpXG5cbiAgICAgIGNvbnNvbGUubG9nKCdbTG9naW4gRGVidWddIEJhc2ljIHRhYmxlIHRlc3QgcmVzdWx0OicsIHtcbiAgICAgICAgc3VjY2VzczogIWJhc2ljRXJyb3IsXG4gICAgICAgIGVycm9yOiBiYXNpY0Vycm9yID8ge1xuICAgICAgICAgIG1lc3NhZ2U6IGJhc2ljRXJyb3IubWVzc2FnZSxcbiAgICAgICAgICBjb2RlOiBiYXNpY0Vycm9yLmNvZGUsXG4gICAgICAgICAgZGV0YWlsczogYmFzaWNFcnJvci5kZXRhaWxzLFxuICAgICAgICAgIGhpbnQ6IGJhc2ljRXJyb3IuaGludCxcbiAgICAgICAgICBmdWxsRXJyb3I6IGJhc2ljRXJyb3JcbiAgICAgICAgfSA6IG51bGwsXG4gICAgICAgIGhhc0RhdGE6ICEhYmFzaWNUZXN0XG4gICAgICB9KVxuXG4gICAgICAvLyBTZWNvbmQgdGVzdDogQ2hlY2sgdGFibGUgc2NoZW1hXG4gICAgICBjb25zb2xlLmxvZygnW0xvZ2luIERlYnVnXSBDaGVja2luZyB1c2VycyB0YWJsZSBzY2hlbWEuLi4nKVxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgeyBkYXRhOiBzY2hlbWFEYXRhLCBlcnJvcjogc2NoZW1hRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgICAgLnJwYygnZXhlY19zcWwnLCB7XG4gICAgICAgICAgICBzcWw6IGBcbiAgICAgICAgICAgICAgU0VMRUNUIGNvbHVtbl9uYW1lLCBkYXRhX3R5cGUsIGlzX251bGxhYmxlXG4gICAgICAgICAgICAgIEZST00gaW5mb3JtYXRpb25fc2NoZW1hLmNvbHVtbnNcbiAgICAgICAgICAgICAgV0hFUkUgdGFibGVfbmFtZSA9ICd1c2VycydcbiAgICAgICAgICAgICAgQU5EIHRhYmxlX3NjaGVtYSA9ICdwdWJsaWMnXG4gICAgICAgICAgICAgIE9SREVSIEJZIG9yZGluYWxfcG9zaXRpb247XG4gICAgICAgICAgICBgXG4gICAgICAgICAgfSlcblxuICAgICAgICBjb25zb2xlLmxvZygnW0xvZ2luIERlYnVnXSBUYWJsZSBzY2hlbWEgcmVzdWx0OicsIHtcbiAgICAgICAgICBzdWNjZXNzOiAhc2NoZW1hRXJyb3IsXG4gICAgICAgICAgY29sdW1uczogc2NoZW1hRGF0YSxcbiAgICAgICAgICBlcnJvcjogc2NoZW1hRXJyb3IgPyB7XG4gICAgICAgICAgICBtZXNzYWdlOiBzY2hlbWFFcnJvci5tZXNzYWdlLFxuICAgICAgICAgICAgY29kZTogc2NoZW1hRXJyb3IuY29kZSxcbiAgICAgICAgICAgIGZ1bGxFcnJvcjogc2NoZW1hRXJyb3JcbiAgICAgICAgICB9IDogbnVsbFxuICAgICAgICB9KVxuICAgICAgfSBjYXRjaCAoc2NoZW1hRXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbTG9naW4gRGVidWddIFNjaGVtYSBjaGVjayBmYWlsZWQ6Jywgc2NoZW1hRXJyIGluc3RhbmNlb2YgRXJyb3IgPyBzY2hlbWFFcnIubWVzc2FnZSA6IFN0cmluZyhzY2hlbWFFcnIpKVxuICAgICAgfVxuXG4gICAgICAvLyBUZXN0IHF1ZXJ5IHdpdGggUkxTIGRpc2FibGVkIChmb3IgZGVidWdnaW5nKVxuICAgICAgY29uc29sZS5sb2coJ1tMb2dpbiBEZWJ1Z10gVGVzdGluZyBxdWVyeSB3aXRoIFJMUyBieXBhc3MuLi4nKVxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgeyBkYXRhOiBybHNUZXN0LCBlcnJvcjogcmxzRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgICAgLnJwYygnZXhlY19zcWwnLCB7XG4gICAgICAgICAgICBzcWw6IGBTRUxFQ1QgaWQsIGVtYWlsLCBuYW1lLCByb2xlIEZST00gdXNlcnMgV0hFUkUgZW1haWwgPSAnJHtub3JtYWxpemVkRW1haWwucmVwbGFjZSgvJy9nLCBcIicnXCIpfScgTElNSVQgMTtgXG4gICAgICAgICAgfSlcblxuICAgICAgICBjb25zb2xlLmxvZygnW0xvZ2luIERlYnVnXSBSTFMgYnlwYXNzIHRlc3QgcmVzdWx0OicsIHtcbiAgICAgICAgICBzdWNjZXNzOiAhcmxzRXJyb3IsXG4gICAgICAgICAgZGF0YTogcmxzVGVzdCxcbiAgICAgICAgICBlcnJvcjogcmxzRXJyb3IgPyB7XG4gICAgICAgICAgICBtZXNzYWdlOiBybHNFcnJvci5tZXNzYWdlLFxuICAgICAgICAgICAgY29kZTogcmxzRXJyb3IuY29kZSxcbiAgICAgICAgICAgIGZ1bGxFcnJvcjogcmxzRXJyb3JcbiAgICAgICAgICB9IDogbnVsbFxuICAgICAgICB9KVxuICAgICAgfSBjYXRjaCAocmxzRXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbTG9naW4gRGVidWddIFJMUyBieXBhc3MgdGVzdCBmYWlsZWQ6JywgcmxzRXJyIGluc3RhbmNlb2YgRXJyb3IgPyBybHNFcnIubWVzc2FnZSA6IFN0cmluZyhybHNFcnIpKVxuICAgICAgfVxuXG4gICAgICAvLyBOb3cgdHJ5IHRoZSBhY3R1YWwgcXVlcnlcbiAgICAgIGNvbnNvbGUubG9nKCdbTG9naW4gRGVidWddIEV4ZWN1dGluZyBhY3R1YWwgdXNlciBsb29rdXAgcXVlcnkuLi4nKVxuICAgICAgY29uc3QgcXVlcnlTdGFydCA9IERhdGUubm93KClcbiAgICAgIGNvbnN0IHsgZGF0YTogdXNlckRhdGEsIGVycm9yOiB1c2VyRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCd1c2VycycpXG4gICAgICAgIC5zZWxlY3QoJ2lkLCBlbWFpbCwgbmFtZSwgcm9sZSwgcGFzc3dvcmRfaGFzaCcpXG4gICAgICAgIC5lcSgnZW1haWwnLCBub3JtYWxpemVkRW1haWwpXG4gICAgICAgIC5tYXliZVNpbmdsZSgpXG4gICAgICBjb25zdCBxdWVyeUVuZCA9IERhdGUubm93KClcblxuICAgICAgY29uc29sZS5sb2coJ1tMb2dpbiBEZWJ1Z10gUXVlcnkgZXhlY3V0aW9uIHRpbWU6JywgcXVlcnlFbmQgLSBxdWVyeVN0YXJ0LCAnbXMnKVxuICAgICAgY29uc29sZS5sb2coJ1tMb2dpbiBEZWJ1Z10gUXVlcnkgcmVzdWx0OicsIHtcbiAgICAgICAgaGFzRGF0YTogISF1c2VyRGF0YSxcbiAgICAgICAgZGF0YUtleXM6IHVzZXJEYXRhID8gT2JqZWN0LmtleXModXNlckRhdGEpIDogbnVsbCxcbiAgICAgICAgZXJyb3I6IHVzZXJFcnJvciA/IHtcbiAgICAgICAgICBtZXNzYWdlOiB1c2VyRXJyb3IubWVzc2FnZSxcbiAgICAgICAgICBjb2RlOiB1c2VyRXJyb3IuY29kZSxcbiAgICAgICAgICBkZXRhaWxzOiB1c2VyRXJyb3IuZGV0YWlscyxcbiAgICAgICAgICBoaW50OiB1c2VyRXJyb3IuaGludCxcbiAgICAgICAgICBmdWxsRXJyb3I6IHVzZXJFcnJvclxuICAgICAgICB9IDogbnVsbFxuICAgICAgfSlcblxuICAgICAgaWYgKHVzZXJFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbTG9naW5dIEZVTEwgREFUQUJBU0UgRVJST1IgZHVyaW5nIGN1c3RvbSBhdXRoOicsIHtcbiAgICAgICAgICBtZXNzYWdlOiB1c2VyRXJyb3IubWVzc2FnZSxcbiAgICAgICAgICBjb2RlOiB1c2VyRXJyb3IuY29kZSxcbiAgICAgICAgICBkZXRhaWxzOiB1c2VyRXJyb3IuZGV0YWlscyxcbiAgICAgICAgICBoaW50OiB1c2VyRXJyb3IuaGludCxcbiAgICAgICAgICBlbWFpbDogbm9ybWFsaXplZEVtYWlsLFxuICAgICAgICAgIHRhYmxlOiAndXNlcnMnLFxuICAgICAgICAgIG9wZXJhdGlvbjogJ1NFTEVDVCB3aXRoIHBhc3N3b3JkX2hhc2gnLFxuICAgICAgICAgIGZ1bGxFcnJvck9iamVjdDogdXNlckVycm9yLFxuICAgICAgICAgIHN1cGFiYXNlVXJsOiBzdXBhYmFzZVVybD8uc3Vic3RyaW5nKDAsIDMwKSArICcuLi4nLFxuICAgICAgICAgIGhhc1NlcnZpY2VLZXk6ICEhc3VwYWJhc2VTZXJ2aWNlS2V5XG4gICAgICAgIH0pXG4gICAgICAgIGlmIChpc0FkbWluQXR0ZW1wdCkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tBZG1pbiBMb2dpbl0gRlVMTCBEQVRBQkFTRSBFUlJPUiBmb3IgYWRtaW4gbG9naW46Jywge1xuICAgICAgICAgICAgbWVzc2FnZTogdXNlckVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgICBjb2RlOiB1c2VyRXJyb3IuY29kZSxcbiAgICAgICAgICAgIGRldGFpbHM6IHVzZXJFcnJvci5kZXRhaWxzLFxuICAgICAgICAgICAgaGludDogdXNlckVycm9yLmhpbnQsXG4gICAgICAgICAgICBlbWFpbDogbm9ybWFsaXplZEVtYWlsLFxuICAgICAgICAgICAgZnVsbEVycm9yT2JqZWN0OiB1c2VyRXJyb3JcbiAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgZm9yIHNwZWNpZmljIGVycm9yIHR5cGVzXG4gICAgICAgIGlmICh1c2VyRXJyb3IuY29kZSA9PT0gJ1BHUlNUMTE2JyB8fCB1c2VyRXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ3JlbGF0aW9uIFwicHVibGljLnVzZXJzXCIgZG9lcyBub3QgZXhpc3QnKSkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tMb2dpbl0gVXNlcnMgdGFibGUgZG9lcyBub3QgZXhpc3QhIFJ1biBkYXRhYmFzZSBzZXR1cCBmaXJzdC4nKVxuICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICAgIHsgZXJyb3I6ICdEYXRhYmFzZSBub3QgaW5pdGlhbGl6ZWQuIFBsZWFzZSBydW4gZGF0YWJhc2Ugc2V0dXAuJyB9LFxuICAgICAgICAgICAgeyBzdGF0dXM6IDUwMyB9XG4gICAgICAgICAgKVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHVzZXJFcnJvci5jb2RlID09PSAnUEdSU1QyMDUnIHx8IHVzZXJFcnJvci5tZXNzYWdlPy5pbmNsdWRlcygncGVybWlzc2lvbiBkZW5pZWQnKSkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tMb2dpbl0gUGVybWlzc2lvbiBkZW5pZWQgYWNjZXNzaW5nIHVzZXJzIHRhYmxlLiBDaGVjayBSTFMgcG9saWNpZXMuJylcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7IGVycm9yOiAnRGF0YWJhc2UgcGVybWlzc2lvbiBlcnJvci4gQ29udGFjdCBhZG1pbmlzdHJhdG9yLicgfSxcbiAgICAgICAgICAgIHsgc3RhdHVzOiA1MDMgfVxuICAgICAgICAgIClcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIHNlcnZpY2UgdGVtcG9yYXJpbHkgdW5hdmFpbGFibGUnLFxuICAgICAgICAgICAgZGV0YWlsczogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyB7XG4gICAgICAgICAgICAgIGRiRXJyb3I6IHVzZXJFcnJvci5tZXNzYWdlLFxuICAgICAgICAgICAgICBjb2RlOiB1c2VyRXJyb3IuY29kZSxcbiAgICAgICAgICAgICAgdGFibGU6ICd1c2VycycsXG4gICAgICAgICAgICAgIG9wZXJhdGlvbjogJ1NFTEVDVCB3aXRoIHBhc3N3b3JkX2hhc2gnXG4gICAgICAgICAgICB9IDogdW5kZWZpbmVkXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNTAzIH1cbiAgICAgICAgKVxuICAgICAgfVxuXG4gICAgICBpZiAoIXVzZXJEYXRhKSB7XG4gICAgICAgIGlmIChpc0FkbWluQXR0ZW1wdCkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdbQWRtaW4gTG9naW5dIEFkbWluIHVzZXIgbm90IGZvdW5kIGluIGRhdGFiYXNlOicsIG5vcm1hbGl6ZWRFbWFpbClcbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmxvZygnW0xvZ2luXSBVc2VyIG5vdCBmb3VuZCBpbiBkYXRhYmFzZTonLCBub3JtYWxpemVkRW1haWwpXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7IGVycm9yOiAnSW52YWxpZCBlbWFpbCBvciBwYXNzd29yZCcgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgICAgKVxuICAgICAgfVxuXG4gICAgICBpZiAoIXVzZXJEYXRhLnBhc3N3b3JkX2hhc2gpIHtcbiAgICAgICAgaWYgKGlzQWRtaW5BdHRlbXB0KSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1tBZG1pbiBMb2dpbl0gQWRtaW4gdXNlciBoYXMgbm8gcGFzc3dvcmQgaGFzaDonLCB1c2VyRGF0YS5lbWFpbCwgJ1JvbGU6JywgdXNlckRhdGEucm9sZSlcbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmxvZygnW0xvZ2luXSBVc2VyIGhhcyBubyBwYXNzd29yZCBoYXNoOicsIHVzZXJEYXRhLmVtYWlsKVxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgeyBlcnJvcjogJ0ludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQnIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICAgIClcbiAgICAgIH1cblxuICAgICAgLy8gVmVyaWZ5IHBhc3N3b3JkIHVzaW5nIGJjcnlwdFxuICAgICAgaWYgKGlzQWRtaW5BdHRlbXB0KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbQWRtaW4gTG9naW5dIFZlcmlmeWluZyBwYXNzd29yZCBoYXNoIGZvciBhZG1pbiB1c2VyOicsIHVzZXJEYXRhLmVtYWlsLCAnUm9sZTonLCB1c2VyRGF0YS5yb2xlKVxuICAgICAgfVxuICAgICAgY29uc29sZS5sb2coJ1tMb2dpbl0gVmVyaWZ5aW5nIHBhc3N3b3JkIGhhc2ggZm9yIHVzZXI6JywgdXNlckRhdGEuZW1haWwpXG4gICAgICBjb25zdCBpc1Bhc3N3b3JkVmFsaWQgPSBhd2FpdCBiY3J5cHQuY29tcGFyZShwYXNzd29yZCwgdXNlckRhdGEucGFzc3dvcmRfaGFzaClcblxuICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgaWYgKGlzQWRtaW5BdHRlbXB0KSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1tBZG1pbiBMb2dpbl0gUGFzc3dvcmQgdmVyaWZpY2F0aW9uIGZhaWxlZCBmb3IgYWRtaW4gdXNlcjonLCB1c2VyRGF0YS5lbWFpbClcbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmxvZygnW0xvZ2luXSBQYXNzd29yZCB2ZXJpZmljYXRpb24gZmFpbGVkIGZvciB1c2VyOicsIHVzZXJEYXRhLmVtYWlsKVxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgeyBlcnJvcjogJ0ludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQnIH0sXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICAgIClcbiAgICAgIH1cblxuICAgICAgLy8gQ3VzdG9tIGF1dGhlbnRpY2F0aW9uIHN1Y2Nlc3NmdWxcbiAgICAgIGF1dGhlbnRpY2F0ZWRVc2VyID0gdXNlckRhdGFcbiAgICAgIGF1dGhNZXRob2QgPSAnY3VzdG9tJ1xuICAgICAgYXV0aFNlc3Npb24gPSB7XG4gICAgICAgIGFjY2Vzc190b2tlbjogYGN1c3RvbV8ke3VzZXJEYXRhLmlkfV8ke0RhdGUubm93KCl9YCwgLy8gVGVtcG9yYXJ5IHRva2VuIGZvciBzZXNzaW9uXG4gICAgICAgIHJlZnJlc2hfdG9rZW46IG51bGwsXG4gICAgICAgIGV4cGlyZXNfYXQ6IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApICsgKDYwICogNjAgKiAyNCAqIDcpLCAvLyA3IGRheXNcbiAgICAgIH1cblxuICAgICAgaWYgKGlzQWRtaW5BdHRlbXB0KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbQWRtaW4gTG9naW5dIEN1c3RvbSBhdXRoZW50aWNhdGlvbiBzdWNjZXNzZnVsIGZvciBhZG1pbiB1c2VyOicsIHVzZXJEYXRhLmVtYWlsLCAnUm9sZTonLCB1c2VyRGF0YS5yb2xlKVxuICAgICAgfVxuICAgICAgY29uc29sZS5sb2coJ1tMb2dpbl0gQ3VzdG9tIGF1dGhlbnRpY2F0aW9uIHN1Y2Nlc3NmdWwgZm9yIHVzZXI6JywgdXNlckRhdGEuZW1haWwsICdSb2xlOicsIHVzZXJEYXRhLnJvbGUpXG5cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gU3VwYWJhc2UgYXV0aGVudGljYXRpb24gc3VjY2Vzc2Z1bFxuICAgICAgY29uc29sZS5sb2coJ1tMb2dpbl0gU3VwYWJhc2UgQXV0aCBzdWNjZXNzZnVsIGZvciB1c2VyOicsIHN1cGFiYXNlRGF0YS51c2VyLmVtYWlsKVxuICAgICAgYXV0aGVudGljYXRlZFVzZXIgPSBzdXBhYmFzZURhdGEudXNlclxuICAgICAgYXV0aFNlc3Npb24gPSBzdXBhYmFzZURhdGEuc2Vzc2lvblxuXG4gICAgICBpZiAoaXNBZG1pbkF0dGVtcHQpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1tBZG1pbiBMb2dpbl0gU3VwYWJhc2UgQXV0aCBzdWNjZXNzZnVsIGZvciBhZG1pbiB1c2VyOicsIHN1cGFiYXNlRGF0YS51c2VyLmVtYWlsKVxuICAgICAgfVxuXG4gICAgICAvLyBGb3IgU3VwYWJhc2UgYXV0aCwgY2hlY2sgaWYgZW1haWwgaXMgY29uZmlybWVkXG4gICAgICBpZiAoIXN1cGFiYXNlRGF0YS51c2VyLmVtYWlsX2NvbmZpcm1lZF9hdCkge1xuICAgICAgICBjb25zb2xlLmxvZygnW0xvZ2luXSBFbWFpbCBub3QgY29uZmlybWVkIGZvciBTdXBhYmFzZSB1c2VyOicsIHN1cGFiYXNlRGF0YS51c2VyLmVtYWlsKVxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgZXJyb3I6ICdQbGVhc2UgY29uZmlybSB5b3VyIGVtYWlsIGFkZHJlc3MgYmVmb3JlIHNpZ25pbmcgaW4uIENoZWNrIHlvdXIgZW1haWwgZm9yIGEgY29uZmlybWF0aW9uIGxpbmsuJyxcbiAgICAgICAgICAgIGNvZGU6ICdFTUFJTF9OT1RfQ09ORklSTUVEJyxcbiAgICAgICAgICAgIGhpbnQ6ICdDbGljayB0aGUgY29uZmlybWF0aW9uIGxpbmsgaW4geW91ciBlbWFpbCwgdGhlbiB0cnkgc2lnbmluZyBpbiBhZ2Fpbi4nXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgICAgKVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghYXV0aGVudGljYXRlZFVzZXIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tMb2dpbl0gTm8gdXNlciBkYXRhIGFmdGVyIGF1dGhlbnRpY2F0aW9uJylcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIGZhaWxlZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApXG4gICAgfVxuXG4gICAgLy8gR2V0IHVzZXIgcHJvZmlsZSBkYXRhXG4gICAgbGV0IHVzZXJQcm9maWxlID0gbnVsbFxuXG4gICAgaWYgKGF1dGhNZXRob2QgPT09ICdzdXBhYmFzZScpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdbTG9naW5dIEZldGNoaW5nIHVzZXIgcHJvZmlsZSBmb3IgU3VwYWJhc2UgdXNlcjonLCBhdXRoZW50aWNhdGVkVXNlci5pZClcbiAgICAgIGNvbnN0IHsgZGF0YTogcHJvZmlsZURhdGEsIGVycm9yOiBwcm9maWxlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCd1c2VycycpXG4gICAgICAgIC5zZWxlY3QoJ2lkLCBlbWFpbCwgbmFtZSwgcm9sZScpXG4gICAgICAgIC5lcSgnaWQnLCBhdXRoZW50aWNhdGVkVXNlci5pZClcbiAgICAgICAgLnNpbmdsZSgpXG5cbiAgICAgIGlmIChwcm9maWxlRXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignW0xvZ2luXSBQcm9maWxlIGZldGNoIGVycm9yOicsIHByb2ZpbGVFcnJvcilcbiAgICAgICAgLy8gU3RpbGwgcmV0dXJuIHN1Y2Nlc3MgYnV0IHdpdGggYmFzaWMgdXNlciBkYXRhIGZyb20gYXV0aFxuICAgICAgICBjb25zdCBzdXBhYmFzZVVzZXIgPSBhdXRoZW50aWNhdGVkVXNlciBhcyBhbnkgLy8gVHlwZSBhc3NlcnRpb24gZm9yIFN1cGFiYXNlIHVzZXJcbiAgICAgICAgdXNlclByb2ZpbGUgPSB7XG4gICAgICAgICAgaWQ6IHN1cGFiYXNlVXNlci5pZCxcbiAgICAgICAgICBlbWFpbDogc3VwYWJhc2VVc2VyLmVtYWlsLFxuICAgICAgICAgIG5hbWU6IHN1cGFiYXNlVXNlci51c2VyX21ldGFkYXRhPy5mdWxsX25hbWUgfHwgc3VwYWJhc2VVc2VyLnVzZXJfbWV0YWRhdGE/Lm5hbWUgfHwgJ1VzZXInLFxuICAgICAgICAgIHJvbGU6IHN1cGFiYXNlVXNlci51c2VyX21ldGFkYXRhPy5yb2xlIHx8ICd1c2VyJyxcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdXNlclByb2ZpbGUgPSBwcm9maWxlRGF0YVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBGb3IgY3VzdG9tIGF1dGgsIHdlIGFscmVhZHkgaGF2ZSB0aGUgdXNlciBwcm9maWxlXG4gICAgICB1c2VyUHJvZmlsZSA9IGF1dGhlbnRpY2F0ZWRVc2VyXG4gICAgfVxuXG4gICAgaWYgKGlzQWRtaW5BdHRlbXB0KSB7XG4gICAgICBjb25zb2xlLmxvZygnW0FkbWluIExvZ2luXSBGaW5hbCBhZG1pbiB1c2VyIHByb2ZpbGU6JywgdXNlclByb2ZpbGUuZW1haWwsICdSb2xlOicsIHVzZXJQcm9maWxlLnJvbGUsICdBdXRoIG1ldGhvZDonLCBhdXRoTWV0aG9kKVxuICAgIH1cbiAgICBjb25zb2xlLmxvZygnW0xvZ2luXSBGaW5hbCB1c2VyIHByb2ZpbGU6JywgdXNlclByb2ZpbGUuZW1haWwsICdSb2xlOicsIHVzZXJQcm9maWxlLnJvbGUpXG5cbiAgICAvLyBDcmVhdGUgdW5pZmllZCBhdXRoIHJlc3BvbnNlXG4gICAgY29uc3QgYXV0aFJlc3BvbnNlID0ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHVzZXI6IHVzZXJQcm9maWxlLFxuICAgICAgc2Vzc2lvbjoge1xuICAgICAgICBhY2Nlc3NfdG9rZW46IGF1dGhTZXNzaW9uPy5hY2Nlc3NfdG9rZW4sXG4gICAgICAgIHJlZnJlc2hfdG9rZW46IGF1dGhTZXNzaW9uPy5yZWZyZXNoX3Rva2VuLFxuICAgICAgICBleHBpcmVzX2F0OiBhdXRoU2Vzc2lvbj8uZXhwaXJlc19hdCxcbiAgICAgIH0sXG4gICAgICBhdXRoX21ldGhvZDogYXV0aE1ldGhvZCAvLyBJbmNsdWRlIGF1dGggbWV0aG9kIGZvciBkZWJ1Z2dpbmdcbiAgICB9XG5cbiAgICAvLyBTZXQgaHR0cE9ubHkgY29va2llIGZvciBpZnJhbWUgYXV0aGVudGljYXRpb25cbiAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5qc29uKGF1dGhSZXNwb25zZSlcblxuICAgIC8vIFNldCBodHRwT25seSBjb29raWUgd2l0aCBKV1QgdG9rZW4gZm9yIGlmcmFtZSBhdXRoZW50aWNhdGlvblxuICAgIGlmIChhdXRoU2Vzc2lvbj8uYWNjZXNzX3Rva2VuKSB7XG4gICAgICBjb25zb2xlLmxvZygnW0xvZ2luXSBTZXR0aW5nIGFjY2Vzc1Rva2VuIGNvb2tpZSBmb3IgaWZyYW1lIGF1dGhlbnRpY2F0aW9uJylcbiAgICAgIHJlc3BvbnNlLmNvb2tpZXMuc2V0KCdhY2Nlc3NUb2tlbicsIGF1dGhTZXNzaW9uLmFjY2Vzc190b2tlbiwge1xuICAgICAgICBodHRwT25seTogdHJ1ZSxcbiAgICAgICAgc2VjdXJlOiBmYWxzZSwgLy8gQWxsb3cgaW4gZGV2ZWxvcG1lbnQgb3ZlciBIVFRQXG4gICAgICAgIHNhbWVTaXRlOiAnbGF4JyxcbiAgICAgICAgbWF4QWdlOiA2MCAqIDYwICogMjQgKiA3LCAvLyA3IGRheXNcbiAgICAgICAgcGF0aDogJy8nLFxuICAgICAgfSlcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzcG9uc2VcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdMb2dpbiBlcnJvcjonLCBlcnJvcilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IFxuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIC4uLihwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyAmJiB7XG4gICAgICAgICAgZGV0YWlsczogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcidcbiAgICAgICAgfSlcbiAgICAgIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApXG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImNyZWF0ZUNsaWVudCIsImJjcnlwdCIsIlBPU1QiLCJyZXF1ZXN0IiwiZW1haWwiLCJwYXNzd29yZCIsImpzb24iLCJlcnJvciIsInN0YXR1cyIsIm5vcm1hbGl6ZWRFbWFpbCIsInRvTG93ZXJDYXNlIiwidHJpbSIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlU2VydmljZUtleSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJjb25zb2xlIiwibG9nIiwiaGFzU3VwYWJhc2VVcmwiLCJoYXNTZXJ2aWNlS2V5Iiwic2VydmljZUtleUxlbmd0aCIsImxlbmd0aCIsInNlcnZpY2VLZXlQcmVmaXgiLCJzdWJzdHJpbmciLCJzdXBhYmFzZSIsImF1dGgiLCJhdXRvUmVmcmVzaFRva2VuIiwicGVyc2lzdFNlc3Npb24iLCJkYXRhIiwidGVzdERhdGEiLCJ0ZXN0RXJyb3IiLCJmcm9tIiwic2VsZWN0IiwibGltaXQiLCJzdWNjZXNzIiwiY29ubmVjdEVycm9yIiwibWVzc2FnZSIsImhhc0RhdGEiLCJpc0FkbWluQXR0ZW1wdCIsImluY2x1ZGVzIiwiYXV0aGVudGljYXRlZFVzZXIiLCJhdXRoTWV0aG9kIiwiYXV0aFNlc3Npb24iLCJzdXBhYmFzZURhdGEiLCJzdXBhYmFzZUVycm9yIiwic2lnbkluV2l0aFBhc3N3b3JkIiwidXNlciIsImJhc2ljVGVzdCIsImJhc2ljRXJyb3IiLCJjb2RlIiwiZGV0YWlscyIsImhpbnQiLCJmdWxsRXJyb3IiLCJzY2hlbWFEYXRhIiwic2NoZW1hRXJyb3IiLCJycGMiLCJzcWwiLCJjb2x1bW5zIiwic2NoZW1hRXJyIiwiRXJyb3IiLCJTdHJpbmciLCJybHNUZXN0IiwicmxzRXJyb3IiLCJyZXBsYWNlIiwicmxzRXJyIiwicXVlcnlTdGFydCIsIkRhdGUiLCJub3ciLCJ1c2VyRGF0YSIsInVzZXJFcnJvciIsImVxIiwibWF5YmVTaW5nbGUiLCJxdWVyeUVuZCIsImRhdGFLZXlzIiwiT2JqZWN0Iiwia2V5cyIsInRhYmxlIiwib3BlcmF0aW9uIiwiZnVsbEVycm9yT2JqZWN0IiwiZGJFcnJvciIsInVuZGVmaW5lZCIsInBhc3N3b3JkX2hhc2giLCJyb2xlIiwiaXNQYXNzd29yZFZhbGlkIiwiY29tcGFyZSIsImFjY2Vzc190b2tlbiIsImlkIiwicmVmcmVzaF90b2tlbiIsImV4cGlyZXNfYXQiLCJNYXRoIiwiZmxvb3IiLCJzZXNzaW9uIiwiZW1haWxfY29uZmlybWVkX2F0IiwidXNlclByb2ZpbGUiLCJwcm9maWxlRGF0YSIsInByb2ZpbGVFcnJvciIsInNpbmdsZSIsInN1cGFiYXNlVXNlciIsIm5hbWUiLCJ1c2VyX21ldGFkYXRhIiwiZnVsbF9uYW1lIiwiYXV0aFJlc3BvbnNlIiwiYXV0aF9tZXRob2QiLCJyZXNwb25zZSIsImNvb2tpZXMiLCJzZXQiLCJodHRwT25seSIsInNlY3VyZSIsInNhbWVTaXRlIiwibWF4QWdlIiwicGF0aCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/auth/login/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@supabase","vendor-chunks/next","vendor-chunks/tslib","vendor-chunks/iceberg-js","vendor-chunks/bcryptjs"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2Flogin%2Froute&page=%2Fapi%2Fauth%2Flogin%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Flogin%2Froute.ts&appDir=C%3A%5CUsers%5Caksha%5CDocuments%5CGitHub%5Csalak%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Caksha%5CDocuments%5CGitHub%5Csalak&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();